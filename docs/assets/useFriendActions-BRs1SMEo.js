import{a as l,s as n,u as f,e as q,o,ap as s}from"./index-D6Dh-tOY.js";const y=(e,r)=>l({queryKey:["friendship-status",e,r],queryFn:async()=>{if(!e||!r||e===r)return null;const{data:d,error:a}=await n.from("friendships").select("id, status, requester_id").or(`and(requester_id.eq.${e},receiver_id.eq.${r}),and(requester_id.eq.${r},receiver_id.eq.${e})`).maybeSingle();return a?(console.error("Error fetching friendship status:",a),null):d},enabled:!!e&&!!r&&e!==r}),F=()=>{const{user:e}=f(),r=q(),d=o({mutationFn:async i=>{if(!e)throw new Error("You must be logged in to send friend requests.");const{error:t}=await n.from("friendships").insert({requester_id:e.id,receiver_id:i});if(t)throw t.code==="23505"?new Error("Friend request already sent or you are already friends."):new Error("Failed to send friend request.")},onSuccess:(i,t)=>{s({title:"Friend request sent!",description:"Your friend request has been sent successfully."}),r.invalidateQueries({queryKey:["friendship-status",e==null?void 0:e.id,t]})},onError:i=>{s({title:"Failed to send friend request",description:i.message,variant:"destructive"})}}),a=o({mutationFn:async i=>{if(!e)throw new Error("You must be logged in to cancel friend requests.");const{error:t}=await n.from("friendships").delete().eq("requester_id",e.id).eq("receiver_id",i).eq("status","pending");if(t)throw new Error("Failed to cancel friend request.")},onSuccess:(i,t)=>{s({title:"Friend request cancelled",description:"Your friend request has been cancelled."}),r.invalidateQueries({queryKey:["friendship-status",e==null?void 0:e.id,t]})},onError:i=>{s({title:"Failed to cancel friend request",description:i.message,variant:"destructive"})}}),u=o({mutationFn:async i=>{const{error:t}=await n.from("friendships").update({status:"accepted"}).eq("id",i);if(t)throw new Error("Failed to accept friend request.")},onSuccess:()=>{s({title:"Friend request accepted!",description:"You are now friends and can see each other's activity."}),r.invalidateQueries({queryKey:["friendship-status"]}),r.invalidateQueries({queryKey:["publicFriends"]}),r.invalidateQueries({queryKey:["notifications"]}),r.invalidateQueries({queryKey:["feed"]})},onError:i=>{s({title:"Failed to accept friend request",description:i.message,variant:"destructive"})}}),c=o({mutationFn:async i=>{const{error:t}=await n.from("friendships").delete().eq("id",i);if(t)throw new Error("Failed to remove friend.")},onSuccess:()=>{s({title:"Friend removed",description:"You are no longer friends with this user."}),r.invalidateQueries({queryKey:["friendship-status"]}),r.invalidateQueries({queryKey:["publicFriends"]})},onError:i=>{s({title:"Failed to remove friend",description:i.message,variant:"destructive"})}});return{sendFriendRequest:d,cancelFriendRequest:a,acceptFriendRequest:u,removeFriend:c}};export{F as a,y as u};
