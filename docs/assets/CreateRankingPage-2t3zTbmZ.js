import{j as e,w as q,I as D,x as Z,y as Y,B as y,A as _,g as G,i as B,P as ee,z as te,X as se,L as F,D as ne,r as f,J as A,a as J,s as C,G as k,u as I,b as O,o as ae,C as K,f as re}from"./index-D6Dh-tOY.js";import{a as ie,u as oe}from"./useUserRankingForCategory-BBEM16vD.js";import{T as le,a as ce,b as de,c as me}from"./tooltip-Bvq1edap.js";import{m as ge}from"./athleteDataMapper-BQhAE8li.js";const he=({rankingTitle:s,setRankingTitle:t,rankingDescription:d,setRankingDescription:o})=>e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg shadow-lg border border-white/20 p-3 sm:p-4 md:p-6 mb-6 sm:mb-8",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-white mb-3 sm:mb-4",children:"Ranking Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"title",className:"text-white text-sm sm:text-base",children:"Ranking Title (Optional)"}),e.jsx(D,{id:"title",value:s,onChange:i=>t(i.target.value),placeholder:"Give your ranking a title...",className:"bg-white/10 border-white/30 text-white placeholder:text-gray-400 mt-1 text-sm sm:text-base"})]}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"description",className:"text-white text-sm sm:text-base",children:"Description (Optional)"}),e.jsx(D,{id:"description",value:d,onChange:i=>o(i.target.value),placeholder:"Explain your ranking criteria...",className:"bg-white/10 border-white/30 text-white placeholder:text-gray-400 mt-1 text-sm sm:text-base"})]})]})]}),Q=s=>{const t=s.toLowerCase();return console.log("Getting position mapping for category:",s),t.includes("goalkeeper")||t.includes("gk")?{positions:["goalkeeper","gk"],activeOnly:!1}:t.includes("defender")||t.includes("defence")||t.includes("defense")?{positions:["centre-back","center-back","left-back","right-back","defender","centre back","center back","left back","right back","cb","lb","rb"],activeOnly:!1}:t.includes("midfielder")||t.includes("midfield")?{positions:["central midfielder","defensive midfielder","attacking midfielder","left midfielder","right midfielder","midfielder","central midfield","defensive midfield","attacking midfield","cm","cdm","cam","lm","rm"],activeOnly:!1}:t.includes("winger")||t.includes("wing")?{positions:["left winger","right winger","winger","left wing","right wing","lw","rw"],activeOnly:!1}:t.includes("forward")||t.includes("striker")||t.includes("attack")?{positions:["striker","centre-forward","center-forward","forward","centre forward","center forward","st","cf"],activeOnly:!1}:t.includes("active")||t.includes("current")?{positions:[],activeOnly:!0}:t.includes("goat")||t.includes("skill")||t.includes("best")||t.includes("greatest")||t.includes("all time")||t.includes("legend")||t.includes("icon")?(console.log("GOAT/Skills category detected - no position filtering"),null):(console.log("No specific filtering rules for category:",s),null)},xe=(s,t,d)=>{if(console.log("Checking athlete match:",{athletePositions:s,positionMapping:t,isActive:d}),t.activeOnly&&!d)return console.log("Athlete filtered out - not active"),!1;if(!t.positions||t.positions.length===0)return console.log("No position requirements - athlete matches"),!0;if(!s||s.length===0)return console.log("Athlete has no positions but category requires specific positions"),!1;const o=s.map(a=>a.toLowerCase().trim()),i=t.positions.map(a=>a.toLowerCase().trim()),l=o.some(a=>i.some(c=>a.includes(c)||c.includes(a)));return console.log("Position match result:",l,{athletePositionsLower:o,requiredPositionsLower:i}),l},ue="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),pe=({allAthletes:s,filteredAthletes:t,searchTerm:d,setSearchTerm:o,selectedLetter:i,setSelectedLetter:l,addAthlete:a,numSelectedAthletes:c,categoryName:h})=>{const u=h?Q(h):null;return e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg shadow-lg border border-white/20 p-3 sm:p-4 md:p-6",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-semibold text-white mb-3 sm:mb-4",children:["Search Athletes (",t.length," available)"]}),u&&e.jsx("div",{className:"mb-3 sm:mb-4 p-3 bg-blue-500/20 rounded-lg border border-blue-400/30",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-200",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-medium",children:["Filtered for: ",u.positions.join(", "),u.activeOnly&&" (Active players only)"]})]})}),e.jsxs("div",{className:"relative mb-3 sm:mb-4",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(D,{value:d,onChange:m=>o(m.target.value),placeholder:"Search for athletes...",className:"pl-10 bg-white/10 border-white/30 text-white placeholder:text-gray-400 text-sm sm:text-base"})]}),e.jsxs("div",{className:"mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-white text-xs sm:text-sm font-medium",children:"Filter by letter:"}),e.jsx(y,{onClick:()=>l(""),size:"sm",variant:"outline",className:i===""?"bg-white/20 border-white text-white hover:bg-white/30 h-7 sm:h-8 px-2 text-xs sm:text-sm":"bg-transparent border-white text-white hover:bg-white/10 h-7 sm:h-8 px-2 text-xs sm:text-sm",children:"All"})]}),e.jsx("div",{className:"grid grid-cols-9 sm:grid-cols-13 gap-1",children:ue.map(m=>e.jsx(y,{onClick:()=>l(m),size:"sm",variant:"outline",className:i===m?"bg-white/20 border-white text-white hover:bg-white/30 h-7 sm:h-8 w-full p-0 text-xs min-w-[28px] sm:min-w-[32px]":"bg-transparent border-white text-white hover:bg-white/10 h-7 sm:h-8 w-full p-0 text-xs min-w-[28px] sm:min-w-[32px]",children:m},m))})]}),e.jsxs("div",{className:"space-y-2 max-h-80 sm:max-h-96 overflow-y-auto",children:[t.map(m=>e.jsxs("div",{className:"flex items-center justify-between p-2 sm:p-3 bg-white/5 rounded-lg border border-white/20 hover:bg-white/10 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0 flex-1",children:[e.jsxs(_,{className:"w-8 h-8 sm:w-10 sm:h-10 border-2 border-white/30",children:[e.jsx(G,{src:m.imageUrl||"/placeholder.svg",alt:m.name}),e.jsx(B,{className:"bg-white/20 text-white text-xs sm:text-sm",children:m.name.charAt(0)})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-semibold text-white text-sm sm:text-base truncate",children:m.name}),m.positions&&m.positions.length>0&&e.jsx("div",{className:"text-xs text-gray-300 truncate",children:m.positions.join(", ")})]})]}),e.jsxs(y,{onClick:()=>a(m),size:"sm",variant:"cta",className:"ml-2 shrink-0 h-8 sm:h-9 px-2 sm:px-3 text-xs sm:text-sm",disabled:c>=10,children:[e.jsx(ee,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Add"}),e.jsx("span",{className:"sm:hidden",children:"+"})]})]},m.id)),d&&t.length===0&&e.jsxs("div",{className:"text-center py-6 sm:py-8 text-gray-400 text-sm sm:text-base",children:['No athletes found matching "',d,'"']}),i&&!d&&t.length===0&&e.jsxs("div",{className:"text-center py-6 sm:py-8 text-gray-400 text-sm sm:text-base",children:['No athletes found starting with "',i,'"']}),!d&&!i&&t.length===0&&u&&e.jsxs("div",{className:"text-center py-6 sm:py-8 text-gray-400 text-sm sm:text-base",children:["No ",u.activeOnly?"active ":"",u.positions.join(" or ")," athletes found"]})]})]})},fe=({selectedAthletes:s,handleDragStart:t,handleDragOver:d,handleDragEnd:o,updateAthletePoints:i,removeAthlete:l})=>e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg shadow-lg border border-white/20 p-3 sm:p-4 md:p-6",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-semibold text-white mb-3 sm:mb-4",children:["Your Ranking (",s.length,"/10 athletes)"]}),s.length===0?e.jsxs("div",{className:"text-center py-8 sm:py-12 text-gray-400",children:[e.jsx(Y,{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-3 sm:mb-4 opacity-50"}),e.jsx("p",{className:"text-sm sm:text-lg",children:"Start by searching and adding athletes to your ranking"})]}):e.jsx("div",{className:"space-y-2 sm:space-y-3 max-h-[calc(10*64px)] sm:max-h-[calc(10*76px)] overflow-y-auto pr-1 sm:pr-2",children:s.map((a,c)=>e.jsxs("div",{draggable:!0,onDragStart:()=>t(c),onDragOver:h=>d(h,c),onDragEnd:o,className:"flex items-center gap-2 sm:gap-4 p-2 sm:p-3 bg-white/5 rounded-lg border border-white/20 cursor-move hover:bg-white/10 transition-colors group",children:[e.jsx("div",{className:"text-sm font-bold text-white w-6 text-center",children:c+1}),e.jsxs(_,{className:"w-8 h-8 sm:w-10 sm:h-10 border-2 border-white/30",children:[e.jsx(G,{src:a.imageUrl||"/placeholder.svg",alt:a.name}),e.jsx(B,{className:"bg-white/20 text-white text-xs sm:text-sm",children:a.name.charAt(0)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold text-white text-sm sm:text-base truncate",children:a.name}),a.error&&e.jsx("p",{className:"text-xs text-red-400 mt-1",children:a.error})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 shrink-0",children:[e.jsx(D,{type:"number",value:a.userPoints,onChange:h=>i(a.id,parseInt(h.target.value)||0),className:te("w-14 sm:w-20 h-8 sm:h-9 text-center bg-white/10 border-white/30 text-white text-xs sm:text-sm",a.error&&"border-red-500 focus-visible:ring-red-500"),min:"0",max:"100"}),e.jsx("span",{className:"text-xs text-gray-300 hidden sm:inline",children:"pts"})]}),e.jsx(y,{onClick:()=>l(a.id),size:"sm",variant:"outline",className:"border-red-400 text-red-400 hover:bg-red-400 hover:text-white h-8 w-8 p-0 shrink-0",children:e.jsx(se,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]},a.id))})]}),z="h-[36px] sm:h-[44px] px-4 sm:px-6 rounded-full font-semibold text-sm sm:text-lg leading-[36px] sm:leading-[44px] flex items-center justify-center py-0",be=({categoryId:s,disabled:t,saveLabel:d,onSave:o,isSaving:i,selectedAthleteCount:l})=>{const c=l<10&&!i;return e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center sm:justify-end gap-3 sm:gap-4 mt-6 sm:mt-8 px-3 sm:px-0",children:[e.jsx(y,{asChild:!0,className:`bg-[#FFD9DF] text-[#AD2637] hover:bg-[#FFD0DA] shadow ${z} order-2 sm:order-1`,disabled:i,children:e.jsx(F,{to:s?`/category/${s}`:"/",children:"Cancel"})}),e.jsx(le,{children:e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsxs(y,{variant:"cta",disabled:t||i,onClick:o,className:`${z} order-1 sm:order-2 ${t&&!i?"opacity-50 cursor-not-allowed grayscale":""} disabled:opacity-50 disabled:cursor-not-allowed disabled:grayscale`,children:["Submit to Leaderboard",e.jsx(ne,{className:"ml-2 h-4 w-4 sm:h-5 sm:w-5"})]})}),c&&e.jsx(me,{children:e.jsx("p",{children:"Select 10 athletes to enable this button."})})]})})]})},we=s=>{const[t,d]=f.useState(s||[]),[o,i]=f.useState(null);return{selectedAthletes:t,addAthlete:r=>{if(t.length>=10)return A.info("You can only rank up to 10 athletes."),!1;const n=t.length+1,x=Math.max(0,100-(n-1)*5);return d(g=>[...g,{...r,userPoints:x,error:null}]),!0},removeAthlete:r=>{d(n=>n.filter(g=>g.id!==r).map((g,p)=>({...g,userPoints:Math.max(0,100-p*5),error:null})))},updateAthletePoints:(r,n)=>{d(x=>x.map(p=>p.id===r?{...p,userPoints:n}:p).map((p,b,w)=>{let j=null;if(p.userPoints<0||p.userPoints>100)j="Points must be 0-100.";else if(b>0){const N=w[b-1];p.userPoints>=N.userPoints?j="Must be less than rank above.":N.userPoints-p.userPoints>10&&(j="Max 10 point gap.")}return{...p,error:j}}))},handleDragStart:r=>{i(r)},handleDragOver:(r,n)=>{if(r.preventDefault(),o===null||o===n)return;const x=[...t],g=x[o];x.splice(o,1),x.splice(n,0,g);const p=x.map((b,w)=>({...b,userPoints:Math.max(0,100-w*5),error:null}));d(p),i(n)},handleDragEnd:()=>{i(null)}}},ve=()=>J({queryKey:["athletes"],queryFn:async()=>{const{data:s,error:t}=await C.from("athletes").select("*").order("name");if(t)throw console.error("Error fetching athletes:",t),new Error(t.message);return s||[]}}),ke=({excludedAthletes:s=[],categoryId:t,categoryName:d}={})=>{const[o,i]=f.useState(""),[l,a]=f.useState(""),{data:c=[],isLoading:h}=ve(),u=f.useMemo(()=>{console.log("Filtering athletes for category:",d),console.log("Total athletes loaded:",c.length);let r=c.map(n=>ge(n));if(console.log("Athletes after mapping:",r.length),d){const n=Q(d);if(console.log("Position mapping result:",n),n){const x=r.length;r=r.filter(g=>xe(g.positions,n,g.isActive)),console.log(`Category filtering: ${x} -> ${r.length} athletes`)}else console.log("No position filtering applied for category:",d)}if(s.length>0){const n=s.map(g=>g.id),x=r.length;r=r.filter(g=>!n.includes(g.id)),console.log(`After excluding selected: ${x} -> ${r.length} athletes`)}if(o.trim()){const n=o.toLowerCase(),x=r.length;r=r.filter(g=>{var N,R,P;const p=g.name.toLowerCase().includes(n),b=(N=g.countryOfOrigin)==null?void 0:N.toLowerCase().includes(n),w=(R=g.nationality)==null?void 0:R.toLowerCase().includes(n),j=(P=g.positions)==null?void 0:P.some(L=>L.toLowerCase().includes(n));return p||b||w||j}),console.log(`After search filtering: ${x} -> ${r.length} athletes`)}if(l){const n=r.length;r=r.filter(x=>x.name.charAt(0).toLowerCase()===l.toLowerCase()),console.log(`After letter filtering: ${n} -> ${r.length} athletes`)}return r.length>0&&console.log("Sample filtered athletes:",r.slice(0,3).map(n=>({name:n.name,positions:n.positions,isActive:n.isActive}))),r},[c,o,l,s,d]);return{searchTerm:o,setSearchTerm:i,selectedLetter:l,setSelectedLetter:a,athletes:u,filteredAthletes:u,isLoading:h,resetSearch:()=>{i(""),a("")}}},ye=k.object({title:k.string().min(3,"Title must be at least 3 characters"),description:k.string().optional(),categoryId:k.string().uuid(),selectedAthletes:k.array(k.object({id:k.string().min(1,"Athlete ID is required"),position:k.number().int().min(1,"Position must be at least 1").max(10,"Position must be at most 10"),points:k.number().int().min(1,"Points must be at least 1").max(100,"Points must be at most 100")})).min(3,"Select at least 3 athletes to rank").max(10,"Maximum 10 athletes allowed")}),je=s=>{const{user:t,openAuthDialog:d,savePreLoginUrl:o}=I(),i=O(),{trackRankingCreated:l}=ie(),a=ae({mutationFn:async({title:c,description:h,categoryId:u,selectedAthletes:m})=>{var b;if(console.log("🔍 useSaveRanking - Saving ranking with data:",{title:c,description:h,categoryId:u,selectedAthletes:m}),!t)throw o(window.location.pathname),d("signup"),new Error("Authentication required");if(ye.parse({title:c,description:h,categoryId:u,selectedAthletes:m}),!t)throw new Error("You must be logged in to save a ranking.");const{data:r,error:n}=await C.from("user_rankings").insert({user_id:t.id,category_id:u,title:c,description:h||null}).select().single();if(n)throw n;const x=m.map(w=>({ranking_id:r.id,athlete_id:w.id,position:w.position,points:w.points})),{error:g}=await C.from("ranking_athletes").insert(x);if(g)throw g;const p=await C.from("categories").select("name").eq("id",u).single();return l(u,((b=p.data)==null?void 0:b.name)||"Unknown"),console.log("🔍 useSaveRanking - Ranking saved successfully with ID:",r.id),r.id},onSuccess:c=>{console.log("🔍 useSaveRanking - Success callback, navigating to ranking:",c),A.success("Ranking saved successfully!");try{i(`/ranking/${c}`,{replace:!0}),console.log("🔍 useSaveRanking - Navigation to ranking page initiated")}catch(h){console.error("🔍 useSaveRanking - Navigation failed, using window.location fallback:",h),window.location.href=`/ranking/${c}`}},onError:c=>{console.error("🔍 useSaveRanking - Failed to save ranking:",c),c.message!=="Authentication required"&&A.error("Failed to save ranking.",{description:c.message})}});return{onSave:c=>{const{rankingTitle:h,rankingDescription:u,selectedAthletes:m}=c;console.log("🔍 useSaveRanking - Raw selected athletes before transformation:",m);const r=m.map((n,x)=>({id:n.id,position:x+1,points:n.userPoints}));return console.log("🔍 useSaveRanking - Transformed athletes:",r),a.mutate({title:h,description:u,categoryId:(s==null?void 0:s.categoryId)||"",selectedAthletes:r})},isSaving:a.isPending,saveRanking:a}},S="pending_athlete_selection",Ne=()=>{const s=f.useCallback((i,l)=>{console.log("Saving athlete selection to localStorage:",i.length,"athletes for category:",l);const a={athletes:i,categoryId:l,timestamp:Date.now()};localStorage.setItem(S,JSON.stringify(a))},[]),t=f.useCallback(i=>{try{const l=localStorage.getItem(S);if(!l)return console.log("No stored athlete selection found"),null;const a=JSON.parse(l);if(console.log("Found stored selection:",a),a.categoryId===i&&Date.now()-a.timestamp<24*60*60*1e3)return console.log("Loading athlete selection from localStorage:",a.athletes.length,"athletes"),a.athletes;console.log("Stored selection is for different category or too old, clearing"),localStorage.removeItem(S)}catch(l){console.error("Error loading athlete selection:",l),localStorage.removeItem(S)}return null},[]),d=f.useCallback(()=>{console.log("Clearing stored athlete selection from localStorage"),localStorage.removeItem(S)},[]),o=f.useCallback(i=>{try{const l=localStorage.getItem(S);if(!l)return!1;const a=JSON.parse(l);return a.categoryId===i&&Date.now()-a.timestamp<24*60*60*1e3}catch{return!1}},[]);return{saveSelection:s,loadSelection:t,clearSelection:d,hasStoredSelection:o}},Se=({category:s})=>{const[t,d]=f.useState(""),[o,i]=f.useState(""),{user:l,openLoginDialog:a,savePreLoginUrl:c}=I();O();const{loadSelection:h,saveSelection:u,clearSelection:m}=Ne(),r=h(s.id),{selectedAthletes:n,addAthlete:x,removeAthlete:g,updateAthletePoints:p,handleDragStart:b,handleDragOver:w,handleDragEnd:j}=we(r||void 0);f.useEffect(()=>{r&&r.length>0&&(console.log("Restoring athlete selection:",r.length,"athletes"),A.success(`Your athlete selection has been restored! (${r.length} athletes)`),m())},[]),f.useEffect(()=>{n.length>0?(console.log("Auto-saving athlete selection:",n.length,"athletes"),u(n,s.id)):n.length===0&&m()},[n,u,m,s.id]);const{searchTerm:N,setSearchTerm:R,selectedLetter:P,setSelectedLetter:L,filteredAthletes:T,resetSearch:V}=ke({excludedAthletes:n,categoryId:s.id,categoryName:s.name}),{onSave:W,isSaving:M}=je({categoryId:s.id}),X=v=>{x(v)&&V()},H=()=>{if(!l){console.log("Redirecting to login, selection already saved"),c(window.location.pathname),a();return}console.log("Preparing to save ranking with athletes:",n);const v=n.filter(E=>E.userPoints>0&&E.userPoints<=100&&!E.error);if(v.length!==10){A.error("Please select exactly 10 athletes with valid points (1-100)");return}W({rankingTitle:t.trim()||"My Ranking",rankingDescription:o,selectedAthletes:v})},$=n.some(v=>!!v.error),U=n.some(v=>v.userPoints<=0||v.userPoints>100);return e.jsxs("div",{className:"min-h-screen flex flex-col px-3 sm:px-4 md:px-8 py-4 md:py-8",children:[e.jsx("div",{className:"mb-6 md:mb-8",children:e.jsx(y,{asChild:!0,size:"lg",className:"bg-white/20 backdrop-blur-sm border-2 border-white/40 text-white hover:bg-white/30 hover:border-white/60 shadow-lg transition-all duration-200 font-semibold text-sm sm:text-base px-3 sm:px-4 py-2",children:e.jsxs(F,{to:`/category/${s.id}`,children:[e.jsx(K,{className:"mr-2 h-4 w-4 sm:h-5 sm:w-5"})," Back to ",s.name]})})}),e.jsxs("header",{className:"mb-6 md:mb-8 text-center sm:text-left",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-extrabold text-white mb-2",children:["Create Your ",s.name," Ranking"]}),e.jsx("p",{className:"text-sm sm:text-base md:text-lg text-gray-300",children:"Search from over 200 football legends and modern stars - from Pelé to Mbappé"})]}),e.jsxs("div",{className:"max-w-6xl mx-auto w-full flex-1",children:[e.jsx(he,{rankingTitle:t,setRankingTitle:d,rankingDescription:o,setRankingDescription:i}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 md:gap-8",children:[e.jsx("div",{className:"order-2 lg:order-1",children:e.jsx(pe,{allAthletes:T,filteredAthletes:T,searchTerm:N,setSearchTerm:R,selectedLetter:P,setSelectedLetter:L,addAthlete:X,numSelectedAthletes:n.length,categoryName:s.name})}),e.jsx("div",{className:"order-1 lg:order-2",children:e.jsx(fe,{selectedAthletes:n,handleDragStart:b,handleDragOver:w,handleDragEnd:j,updateAthletePoints:p,removeAthlete:g})})]}),e.jsx(be,{categoryId:s.id,disabled:n.length!==10||$||U,saveLabel:M?"Saving...":`Save Ranking (${n.length}/10)`,onSave:H,isSaving:M,selectedAthleteCount:n.length}),($||U)&&e.jsx("p",{className:"text-center sm:text-right text-red-400 mt-2 text-sm",children:"Please fix the validation errors and ensure all points are between 1-100 before saving."})]})]})},De=()=>{const{categoryId:s}=re(),{user:t}=I(),d=O();console.log("🔍 CreateRankingPage - URL categoryId from params:",s),console.log("🔍 CreateRankingPage - Current user:",t==null?void 0:t.id);const{data:o,isLoading:i}=oe(s);console.log("🔍 CreateRankingPage - User ranking check result:",{userRanking:o,categoryId:s,hasExistingRanking:!!o,isLoading:i}),f.useEffect(()=>{o&&o.id&&(console.log("🔍 CreateRankingPage - User has existing ranking, redirecting to:",o.id),d(`/ranking/${o.id}`,{replace:!0}))},[o,d]);const{data:l,isLoading:a}=J({queryKey:["category",s],queryFn:async()=>{console.log("🔍 CreateRankingPage - Fetching category data for:",s);const{data:c,error:h}=await C.from("categories").select("*").eq("id",s||"").single();if(h&&h.code!=="PGRST116")throw console.error("🔍 CreateRankingPage - Category fetch error:",h),h;return c?(console.log("🔍 CreateRankingPage - Category data loaded:",c),{id:c.id,name:c.name,description:c.description||"",userRankingCount:0,leaderboard:[]}):(console.log("🔍 CreateRankingPage - No category found for ID:",s),null)},enabled:!!s});return a||t&&i?e.jsx("div",{className:"min-h-screen flex flex-col px-3 sm:px-4 md:px-8",style:{background:"linear-gradient(135deg, #190749 0%, #070215 100%)"},children:e.jsx("main",{className:"flex-grow flex items-center justify-center container mx-auto py-4 sm:py-6 md:py-8 text-center text-white",children:e.jsx("p",{className:"text-sm sm:text-base",children:"Loading..."})})}):o?(console.log("🔍 CreateRankingPage - Fallback: User has ranking but redirect didn't work, showing manual redirect"),e.jsx("div",{className:"min-h-screen flex flex-col px-3 sm:px-4 md:px-8",style:{background:"linear-gradient(135deg, #190749 0%, #070215 100%)"},children:e.jsx("main",{className:"flex-grow flex items-center justify-center container mx-auto py-4 sm:py-6 md:py-8 text-center",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white mb-4",children:"Redirecting to Your Ranking..."}),e.jsxs("p",{className:"text-gray-300 mb-6 text-sm sm:text-base",children:["You already have a ranking for ",l==null?void 0:l.name,". Taking you there now."]}),e.jsx(y,{onClick:()=>d(`/ranking/${o.id}`,{replace:!0}),size:"lg",className:"bg-gradient-to-r from-fuchsia-500 to-cyan-500 text-white hover:opacity-90 border-0 shadow-lg transition-all duration-200 font-semibold text-sm sm:text-base px-4 sm:px-6 py-2",children:"View My Ranking"})]})})})):l?(console.log("🔍 CreateRankingPage - Proceeding to RankingEditor with category:",l),e.jsx("div",{className:"min-h-screen flex flex-col mb-0",style:{background:"linear-gradient(135deg, #190749 0%, #070215 100%)"},children:e.jsx("main",{className:"container mx-auto flex-grow",children:e.jsx(Se,{category:l})})})):(console.log("🔍 CreateRankingPage - Category not found, showing not found message"),e.jsx("div",{className:"min-h-screen flex flex-col px-3 sm:px-4 md:px-8",style:{background:"linear-gradient(135deg, #190749 0%, #070215 100%)"},children:e.jsx("main",{className:"flex-grow flex items-center justify-center container mx-auto py-4 sm:py-6 md:py-8 text-center",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white mb-4",children:"Category Not Found"}),e.jsx("p",{className:"text-gray-300 mb-6 text-sm sm:text-base",children:"The category you're looking for doesn't exist or couldn't be loaded."}),e.jsx(y,{asChild:!0,size:"lg",className:"bg-gradient-to-r from-fuchsia-500 to-cyan-500 text-white hover:opacity-90 border-0 shadow-lg transition-all duration-200 font-semibold text-sm sm:text-base px-4 sm:px-6 py-2",children:e.jsxs(F,{to:"/",children:[e.jsx(K,{className:"mr-2 h-4 w-4"})," Go Back to Categories"]})})]})})}))};export{De as default};
