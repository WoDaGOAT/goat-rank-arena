import{c as B,ag as P,h as u,j as e,l as v,n as y,L as x,A as g,g as p,i as f,a3 as E,q as _,B as R,M as G,a9 as V,r as w,T as k,t as W,v as Q,k as F,a5 as I,a as H,ah as J,S as K,d as X}from"./index-D6Dh-tOY.js";import{u as Y,a as Z}from"./useFriendActions-BRs1SMEo.js";import{S as ee,R as se}from"./RankedAthleteRow-DhcuKDpD.js";import{S as te,T as S,F as re}from"./ShareDialog-WkeXcJas.js";import{T as ae,S as ne,a as ie}from"./target-Bezeda79.js";import{F as C}from"./flame-DVX3-eVT.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=B("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),ce=({data:s,createdAt:a})=>{const{user:t}=P(),{data:r}=Y(t==null?void 0:t.id,s.user_id),{sendFriendRequest:c,cancelFriendRequest:o}=Z();if(!s.user_name||s.user_name.trim()==="")return null;const l=u(s.user_name),i=()=>{c.mutate(s.user_id)},n=()=>{o.mutate(s.user_id)},m=()=>{if(!r)return"Add Friend";switch(r.status){case"pending":return r.requester_id===(t==null?void 0:t.id)?"Cancel Request":"Accept Request";case"accepted":return"Friends";case"declined":case"blocked":return"Unavailable";default:return"Add Friend"}},d=()=>r&&r.status==="pending"&&r.requester_id===(t==null?void 0:t.id)?n:i,h=()=>!t||t.id===s.user_id?!1:!r||r.status==="pending"&&r.requester_id===t.id||r.status==="pending"&&r.requester_id!==t.id;return e.jsx(v,{className:"bg-white/5 text-white border-gray-700",children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[e.jsx(x,{to:`/users/${s.user_id}`,children:e.jsxs(g,{className:"cursor-pointer hover:opacity-80 transition-opacity",children:[e.jsx(p,{src:s.avatar_url||void 0,alt:l}),e.jsx(f,{children:l.charAt(0).toUpperCase()})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4 text-green-400"}),e.jsx(x,{to:`/users/${s.user_id}`,className:"font-bold hover:underline hover:text-blue-300 transition-colors",children:l})," "," joined WoDaGOAT"]}),e.jsx("p",{className:"text-xs text-gray-400",children:_(new Date(a),{addSuffix:!0})})]}),t&&t.id!==s.user_id&&e.jsx(R,{onClick:d(),disabled:!h()||c.isPending||o.isPending,variant:(r==null?void 0:r.status)==="accepted"?"secondary":"default",size:"sm",className:"text-xs",children:c.isPending||o.isPending?"Loading...":m()})]})})})},oe=({data:s,createdAt:a})=>{const{user:t,category:r,comment_preview:c}=s;if(!(t!=null&&t.full_name)||t.full_name.trim()===""||!(r!=null&&r.name))return null;const o=t.full_name,l=t.avatar_url,i=u(o),n=r.name,m=u(c)||"";return e.jsx(v,{className:"bg-white/5 text-white border-gray-700",children:e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[t.id?e.jsx(x,{to:`/users/${t.id}`,children:e.jsxs(g,{className:"cursor-pointer hover:opacity-80 transition-opacity",children:[e.jsx(p,{src:l||void 0,alt:i}),e.jsx(f,{children:i.charAt(0).toUpperCase()})]})}):e.jsxs(g,{children:[e.jsx(p,{src:l||void 0,alt:i}),e.jsx(f,{children:i.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-blue-300"}),t.id?e.jsx(x,{to:`/users/${t.id}`,className:"font-bold hover:underline hover:text-blue-300 transition-colors",children:i}):e.jsx("span",{className:"font-bold",children:i})," "," commented on "," ",e.jsx(x,{to:`/category/${r.id}`,className:"text-blue-300 hover:underline",children:u(n)})]}),e.jsx("p",{className:"text-xs text-gray-400",children:_(new Date(a),{addSuffix:!0})})]})]}),e.jsx("div",{className:"bg-white/10 rounded-lg p-3 ml-5",children:e.jsxs("p",{className:"text-sm text-gray-200 italic",children:['"',m.length>100?m.substring(0,100)+"...":m,'"']})})]})})},de=({data:s,createdAt:a})=>{const{requester:t,receiver:r}=s;return!(t!=null&&t.full_name)||t.full_name.trim()===""||!(r!=null&&r.full_name)||r.full_name.trim()===""?null:e.jsx(v,{className:"bg-white/5 text-white border-gray-700",children:e.jsxs(y,{className:"p-4 flex flex-col items-center gap-2 text-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(g,{children:[e.jsx(p,{src:t.avatar_url||void 0,alt:t.full_name}),e.jsx(f,{children:t.full_name.charAt(0).toUpperCase()})]}),e.jsx(V,{className:"w-5 h-5 text-green-400"}),e.jsxs(g,{children:[e.jsx(p,{src:r.avatar_url||void 0,alt:r.full_name}),e.jsx(f,{children:r.full_name.charAt(0).toUpperCase()})]})]}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-bold",children:t.full_name})," "," and "," ",e.jsx("span",{className:"font-bold",children:r.full_name})," "," are now friends."]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:_(new Date(a),{addSuffix:!0})})]})]})})},xe=({data:s,createdAt:a})=>{console.log("NewRankingFeedItem received data:",s);const[t,r]=w.useState(!1),[c,o]=w.useState(!1),l=s.user||s.author,i=s.category||(s.category_id&&s.category_name?{id:s.category_id,name:s.category_name}:null);let n=[];if(s.top_athletes&&Array.isArray(s.top_athletes))n=s.top_athletes;else if(s.athletes){if(Array.isArray(s.athletes))n=s.athletes;else if(typeof s.athletes=="string")try{const N=JSON.parse(s.athletes);n=Array.isArray(N)?N:[]}catch(N){console.warn("Failed to parse athletes data:",N),n=[]}}if(!(l!=null&&l.full_name)||l.full_name.trim()===""||!(i!=null&&i.name))return console.log("NewRankingFeedItem: Missing required data",{userProfile:l,category:i}),null;const m=l.full_name,d=l.avatar_url,h=u(m),b=i.name,j=t?n:n==null?void 0:n.slice(0,3),z=n&&n.length>3,A=s.ranking_id&&s.ranking_id.trim()!=="",D=A?`${window.location.origin}/ranking/${s.ranking_id}`:window.location.href,O=`${s.ranking_title} - WoDaGOAT Ranking`,$=`Check out ${h}'s ${b} GOAT ranking on WoDaGOAT!`,L=(n==null?void 0:n.slice(0,5).map(N=>N.name))||[],M=[`#${b.replace(/\s+/g,"")}`];return e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"bg-white/5 text-white border-gray-700",children:e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[l.id?e.jsx(x,{to:`/users/${l.id}`,children:e.jsxs(g,{className:"cursor-pointer hover:opacity-80 transition-opacity",children:[e.jsx(p,{src:d||void 0,alt:h}),e.jsx(f,{children:h.charAt(0).toUpperCase()})]})}):e.jsxs(g,{children:[e.jsx(p,{src:d||void 0,alt:h}),e.jsx(f,{children:h.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4 text-yellow-400"}),l.id?e.jsx(x,{to:`/users/${l.id}`,className:"font-bold hover:underline hover:text-blue-300 transition-colors",children:h}):e.jsx("span",{className:"font-bold",children:h})," "," created a new ranking in "," ",e.jsx(x,{to:`/category/${i.id}`,className:"text-blue-300 hover:underline",children:u(b)})]}),e.jsx("p",{className:"text-xs text-gray-400",children:_(new Date(a),{addSuffix:!0})})]}),A&&e.jsx(R,{onClick:()=>o(!0),variant:"ghost",size:"sm",className:"text-gray-400 hover:text-blue-300 hover:bg-white/10",children:e.jsx(ee,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-4 ml-5",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[s.ranking_title&&s.ranking_title.trim()&&s.ranking_title!=="My Ranking"&&e.jsx("h4",{className:"font-semibold text-blue-300",children:u(s.ranking_title)}),A?e.jsx(x,{to:`/ranking/${s.ranking_id}`,className:"text-xs text-blue-300 hover:text-blue-200 hover:underline",children:"View full ranking"}):e.jsx("span",{className:"text-xs text-gray-500",children:"Ranking details unavailable"})]}),e.jsx("div",{className:"space-y-2",children:j==null?void 0:j.map(N=>e.jsx(se,{athlete:N},N.id))}),z&&e.jsx("button",{onClick:()=>r(!t),className:"w-full text-xs text-blue-300 hover:text-blue-200 mt-3 py-2 rounded-md hover:bg-white/5 transition-colors flex items-center justify-center gap-1",children:t?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-3 h-3"}),"Show less"]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-3 h-3"}),"+",n.length-3," more athletes"]})}),(!n||n.length===0)&&e.jsx("p",{className:"text-xs text-gray-400 text-center",children:"No athletes in this ranking yet"})]})]})}),A&&e.jsx(te,{open:c,onOpenChange:o,url:D,text:$,title:O,description:$,hashtags:M,isRanking:!0,topAthletes:L,categoryName:b})]})},me=({data:s,createdAt:a})=>{const{user:t,quiz:r,score:c,total_questions:o}=s;if(!(t!=null&&t.full_name)||t.full_name.trim()===""||!(r!=null&&r.title))return null;const l=t.full_name,i=t.avatar_url,n=u(l),m=r.title,d=Math.round(c/o*100),h=()=>d===100?"text-yellow-400":d>=80?"text-green-400":d>=60?"text-blue-400":"text-gray-400",j=d===100?le:d>=80?k:ae;return e.jsx(v,{className:"bg-white/5 text-white border-gray-700",children:e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[t.id?e.jsx(x,{to:`/users/${t.id}`,children:e.jsxs(g,{className:"cursor-pointer hover:opacity-80 transition-opacity",children:[e.jsx(p,{src:i||void 0,alt:n}),e.jsx(f,{children:n.charAt(0).toUpperCase()})]})}):e.jsxs(g,{children:[e.jsx(p,{src:i||void 0,alt:n}),e.jsx(f,{children:n.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4 text-blue-300"}),t.id?e.jsx(x,{to:`/users/${t.id}`,className:"font-bold hover:underline hover:text-blue-300 transition-colors",children:n}):e.jsx("span",{className:"font-bold",children:n})," "," completed a quiz"]}),e.jsx("p",{className:"text-xs text-gray-400",children:_(new Date(a),{addSuffix:!0})})]})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-4 ml-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-blue-300",children:u(m)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:`w-4 h-4 ${h()}`}),e.jsxs("span",{className:`font-bold ${h()}`,children:[c,"/",o]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(F,{variant:"outline",className:`${h()} border-current`,children:[d,"% Accuracy"]}),d===100&&e.jsx(F,{className:"bg-yellow-500/20 text-yellow-400 border-yellow-400/50",children:"Perfect Score!"})]})]})]})})},he=({data:s,createdAt:a})=>{const{user:t,badge:r}=s;if(!(t!=null&&t.full_name)||t.full_name.trim()===""||!(r!=null&&r.name))return null;const c=t.full_name,o=t.avatar_url,l=u(c),i=r.name,n=r.description,m=r.rarity||"common",d=j=>{switch(j){case"legendary":return"text-yellow-400 border-yellow-400/50 bg-yellow-500/20";case"epic":return"text-purple-400 border-purple-400/50 bg-purple-500/20";case"rare":return"text-blue-400 border-blue-400/50 bg-blue-500/20";default:return"text-green-400 border-green-400/50 bg-green-500/20"}},b=(j=>{switch(j){case"goat":return k;case"legend":return ie;case"perfect_score":case"triple_perfect":return I;case"streak_3":case"streak_10":return C;default:return ne}})(r.id);return e.jsx(v,{className:"bg-white/5 text-white border-gray-700",children:e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[t.id?e.jsx(x,{to:`/users/${t.id}`,children:e.jsxs(g,{className:"cursor-pointer hover:opacity-80 transition-opacity",children:[e.jsx(p,{src:o||void 0,alt:l}),e.jsx(f,{children:l.charAt(0).toUpperCase()})]})}):e.jsxs(g,{children:[e.jsx(p,{src:o||void 0,alt:l}),e.jsx(f,{children:l.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-purple-400"}),t.id?e.jsx(x,{to:`/users/${t.id}`,className:"font-bold hover:underline hover:text-blue-300 transition-colors",children:l}):e.jsx("span",{className:"font-bold",children:l})," "," earned a new badge"]}),e.jsx("p",{className:"text-xs text-gray-400",children:_(new Date(a),{addSuffix:!0})})]})]}),e.jsx("div",{className:`rounded-lg p-4 ml-5 border ${d(m)}`,children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`p-2 rounded-full ${d(m)}`,children:e.jsx(b,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-white",children:u(i)}),e.jsx("p",{className:"text-sm text-gray-300",children:u(n)})]}),e.jsx(F,{variant:"outline",className:`capitalize ${d(m)}`,children:m})]})})]})})},U=w.memo(({data:s,createdAt:a})=>{var m,d;if(console.log("RankingReactionFeedItem received data:",s),!((m=s.reacting_user)!=null&&m.full_name)||!((d=s.ranking)!=null&&d.title))return console.log("RankingReactionFeedItem: Missing required data",s),null;const t=u(s.reacting_user.full_name),r=u(s.ranking.title),c=u(s.ranking.author.full_name),o=u(s.ranking.category_name),i=(h=>{switch(h){case"thumbs-up":return{icon:S,label:"liked",emoji:"👍",color:"text-blue-300"};case"trophy":return{icon:k,label:"thinks is champion",emoji:"🏆",color:"text-yellow-300"};case"flame":return{icon:C,label:"thinks is fire",emoji:"🔥",color:"text-orange-300"};case"frown":return{icon:re,label:"disagrees with",emoji:"😔",color:"text-red-300"};default:return{icon:S,label:"reacted to",emoji:"👍",color:"text-gray-300"}}})(s.reaction_type),n=i.icon;return e.jsx(v,{className:"bg-white/5 text-white border-gray-700",children:e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-3",children:[e.jsx(x,{to:`/users/${s.reacting_user.id}`,children:e.jsxs(g,{className:"cursor-pointer hover:opacity-80 transition-opacity w-10 h-10",children:[e.jsx(p,{src:s.reacting_user.avatar_url||void 0,alt:t}),e.jsx(f,{className:"text-sm",children:t.charAt(0).toUpperCase()})]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"flex items-center gap-2 flex-wrap text-sm",children:[e.jsx(n,{className:`w-4 h-4 ${i.color} flex-shrink-0`}),e.jsx(x,{to:`/users/${s.reacting_user.id}`,className:"font-bold hover:underline hover:text-blue-300 transition-colors truncate",children:t}),e.jsx("span",{className:"flex-shrink-0",children:i.label}),e.jsxs(x,{to:`/users/${s.ranking.author.id}`,className:"font-medium hover:underline hover:text-blue-300 transition-colors truncate",children:[c,"'s"]}),e.jsx(x,{to:`/category/${s.ranking.category_id}`,className:"text-blue-300 hover:underline truncate",children:o}),e.jsx("span",{className:"flex-shrink-0",children:"ranking"})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:_(new Date(a),{addSuffix:!0})})]}),e.jsx("div",{className:"flex items-center gap-1 flex-shrink-0",children:e.jsx("span",{className:"text-lg",children:i.emoji})})]}),e.jsx("div",{className:"bg-white/10 rounded-lg p-3 ml-14",children:e.jsxs("div",{className:"flex justify-between items-start",children:[s.ranking.title&&s.ranking.title.trim()&&s.ranking.title!=="My Ranking"&&e.jsx("h4",{className:"font-semibold text-blue-300 text-sm truncate flex-1 mr-2",children:r}),e.jsx(x,{to:`/ranking/${s.ranking.id}`,className:"text-xs text-blue-300 hover:text-blue-200 hover:underline flex-shrink-0",children:"View"})]})})]})})});U.displayName="OptimizedRankingReactionFeedItem";function ue(s){return["new_user","new_comment","accepted_friendship","new_ranking","quiz_completed","badge_earned","ranking_reaction"].includes(s)}const T=w.memo(({item:s})=>{if(console.log("FeedItemRenderer received item:",s),!ue(s.type))return console.warn(`Unknown feed item type: ${s.type}`),null;const a={...s,type:s.type};try{switch(a.type){case"new_user":return e.jsx(ce,{data:a.data,createdAt:a.created_at});case"new_comment":return e.jsx(oe,{data:a.data,createdAt:a.created_at});case"accepted_friendship":return e.jsx(de,{data:a.data,createdAt:a.created_at});case"new_ranking":return console.log("Rendering new_ranking item with data:",a.data),e.jsx(xe,{data:a.data,createdAt:a.created_at});case"quiz_completed":return e.jsx(me,{data:a.data,createdAt:a.created_at});case"badge_earned":return e.jsx(he,{data:a.data,createdAt:a.created_at});case"ranking_reaction":return console.log("Rendering ranking_reaction item with data:",a.data),e.jsx(U,{data:a.data,createdAt:a.created_at});default:return null}}catch(t){return console.error("Error rendering feed item:",t,a),null}});T.displayName="FeedItemRenderer";const ge=(s={})=>{const{limit:a=15,offset:t=0}=s;return H({queryKey:["feed",a,t],queryFn:async()=>{console.log(`Fetching feed with limit: ${a}, offset: ${t}`);const{data:r,error:c}=await J.from("feed_items").select("*").order("created_at",{ascending:!1}).range(t,t+a-1);if(c)throw console.error("Error fetching feed:",c),c;return console.log(`Feed items fetched: ${(r==null?void 0:r.length)||0}`),r||[]},staleTime:2*60*1e3,gcTime:10*60*1e3,refetchOnWindowFocus:!1,refetchInterval:!1,refetchOnMount:!0})},q=w.memo(()=>{const[s,a]=w.useState(0),{data:t,isLoading:r,refetch:c,isFetching:o}=ge({limit:15}),l=w.useCallback(()=>{a(i=>i+1),c()},[c]);return r?e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((i,n)=>e.jsx(K,{className:"h-24 w-full bg-white/10 rounded-lg"},n))}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Activity Feed"}),e.jsxs(R,{onClick:l,variant:"outline",size:"sm",disabled:o,className:"bg-white/10 border-white/20 text-white hover:bg-white/20",children:[e.jsx(X,{className:`h-4 w-4 mr-2 ${o?"animate-spin":""}`}),"Refresh"]})]}),t&&t.length>0?t.map(i=>e.jsx(T,{item:i},`${i.id}-${s}`)):e.jsxs("div",{className:"text-center py-10",children:[e.jsx("p",{className:"text-gray-400",children:"The feed is empty."}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Start by creating rankings and interacting with the platform to see updates here!"})]})]})});q.displayName="OptimizedFeedList";const ve=()=>e.jsxs("div",{className:"flex flex-col flex-grow min-h-screen",style:{background:"linear-gradient(135deg, #190749 0%, #070215 100%)"},children:[e.jsx("header",{className:"bg-transparent text-primary-foreground py-6 px-4 text-center shadow-md",children:e.jsxs("div",{className:"container mx-auto pt-6",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl lg:text-4xl xl:text-5xl font-bold mb-2 max-w-4xl mx-auto text-white font-poppins",children:"Latest GOAT moves."}),e.jsx("p",{className:"text-xl sm:text-2xl lg:text-3xl font-semibold max-w-4xl mx-auto text-blue-300 font-poppins",children:"Fresh from the field."})]})}),e.jsx("div",{className:"container mx-auto px-4 py-6 flex-grow",children:e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsx(q,{})})})]});export{ve as default};
