import{j as e,H as E,u as O,B as A,L as w,P as b,E as _,a as N,s as f,J as k,S as C,F as v,T as L}from"./index-D6Dh-tOY.js";import{G,C as R}from"./CommentSection-qz_mWrea.js";import{S}from"./SocialActions-w3zlBMlD.js";import{u as q}from"./useUserRankingForCategory-BBEM16vD.js";import{m as F}from"./athleteDataMapper-BQhAE8li.js";import"./trending-down-CZzN4wpH.js";import"./trending-up-C7CvnSET.js";import"./ShareDialog-WkeXcJas.js";import"./textarea-DAWKKPAt.js";import"./flame-DVX3-eVT.js";const P=()=>e.jsxs(E,{children:[e.jsx("title",{children:"Wodagoat - Rank the GOATs of Sports"}),e.jsx("meta",{name:"description",content:"The ultimate platform for sports fans to rank their favorite athletes, debate the GOATs, and see global leaderboards for sports like Football, Cricket, Tennis, and more."})]}),W=({goatFootballer:r})=>{const{user:s}=O(),{data:o,isLoading:l}=q(r==null?void 0:r.id),u=s?l?{text:"Loading...",icon:b}:o?{text:"View My Ranking",icon:_}:{text:"Create Your Ranking",icon:b}:{text:"Create Your Ranking",icon:b},t=u.icon;return e.jsx("div",{className:"w-full space-y-6",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative",children:e.jsx(G,{athletes:r.leaderboard,categoryName:r.name,submittedRankingsCount:r.userRankingCount,compact:!1,categoryId:r.id,socialActions:e.jsx(S,{categoryId:r.id})})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(A,{asChild:!0,variant:"cta",size:"lg",className:"rounded-full",disabled:l,children:e.jsxs(w,{to:`/create-ranking/${r.id}`,children:[e.jsx(t,{className:"h-5 w-5 mr-2"}),u.text]})})}),e.jsx(R,{categoryId:r.id})]}):e.jsx("div",{className:"text-center text-muted-foreground",children:e.jsx("p",{children:"GOAT Footballer category not found."})})})},I=()=>N({queryKey:["parentCategories"],queryFn:async()=>{const{data:r,error:s}=await f.from("categories").select("id, name").in("name",["GOAT","Current GOAT","Competitions"]).is("parent_id",null);if(s||!r||r.length===0)throw k.error("Failed to load parent categories."),console.error("Error fetching parent categories for homepage:",s),new Error((s==null?void 0:s.message)||"Parent categories not found");return r.map(o=>o.id)},staleTime:1e3*60*10}),$=r=>N({queryKey:["categoriesWithRankings",r],queryFn:async()=>{const{data:s,error:o}=await f.from("categories").select(`
          id,
          name,
          description,
          image_url,
          parent_id
        `).in("parent_id",r).order("name");if(o)throw k.error("Failed to load categories."),console.error("Error fetching categories:",o),new Error(o.message);const l=s.map(i=>i.id),{data:m,error:u}=await f.from("user_rankings").select("category_id").in("category_id",l);u&&console.error("Error fetching ranking counts:",u);const t={};return m&&m.forEach(i=>{const c=i.category_id;t[c]=(t[c]||0)+1}),console.log("Ranking counts by category:",t),{categoriesWithCounts:s,rankingCountMap:t}},enabled:r.length>0,staleTime:1e3*60*5}),B=async(r,s,o)=>{const l=["GOAT Attacker","GOAT Skills","Current GOAT"],m=r.sort((t,i)=>{const c=s[t.id]||0,x=s[i.id]||0;if(c!==x)return x-c;const d=l.indexOf(t.name),n=l.indexOf(i.name);return d!==-1&&n!==-1?d-n:d!==-1?-1:n!==-1?1:t.name.localeCompare(i.name)});return console.log("Sorted categories:",m.map(t=>({name:t.name,count:s[t.id]||0}))),await Promise.all(m.map(async t=>{const i=s[t.id]||0,{data:c,error:x}=await f.from("user_rankings").select(`
          ranking_athletes(
            athlete_id,
            position,
            points
          )
        `).eq("category_id",t.id);let d=[];if(!x&&c&&c.length>0&&o){console.log(`Processing leaderboard for ${t.name}, found ${c.length} rankings`);const n={};c.forEach(a=>{a.ranking_athletes&&Array.isArray(a.ranking_athletes)&&a.ranking_athletes.forEach(g=>{const h=g.athlete_id,j=g.points;h&&j&&(n[h]||(n[h]={totalScore:0,appearances:0}),n[h].totalScore+=j,n[h].appearances+=1)})}),console.log(`Found ${Object.keys(n).length} athletes with scores for ${t.name}`);const p=Object.entries(n).map(([a,{totalScore:g}])=>{const h=o.find(T=>T.id===a);return h?F(h,0,g):(console.warn(`Athlete data not found for ID: ${a}`),null)}).filter(a=>a!==null),y=t.name==="GOAT Footballer"?10:3;d=p.sort((a,g)=>g.points-a.points).slice(0,y).map((a,g)=>({...a,rank:g+1})),console.log(`Final leaderboard for ${t.name}:`,d.length,"athletes")}else console.log(`No rankings found for ${t.name}`);return{id:t.id,name:t.name,description:t.description||"No description provided.",imageUrl:t.image_url||void 0,userRankingCount:i,leaderboard:d}}))},Y=()=>{const{data:r,isLoading:s,error:o}=I(),{data:l,isLoading:m,error:u}=$(r||[]);return N({queryKey:["homepageCategories","v6",r,l],queryFn:async()=>{var y;if(console.log("Starting homepage categories query with dynamic selection..."),!r||!l)throw new Error("Missing parent categories or categories data");const{data:t,error:i}=await f.from("athletes").select("*").order("name");if(i)throw console.error("Error fetching athletes:",i),k.error("Failed to load athlete data."),new Error(i.message);console.log("Athletes fetched:",(t==null?void 0:t.length)||0);const{categoriesWithCounts:c,rankingCountMap:x}=l,d=await B(c,x,t),n=d.find(a=>a.name==="GOAT Footballer")||null,p=d.filter(a=>a.name!=="GOAT Footballer").slice(0,5);return console.log("GOAT Footballer leaderboard:",((y=n==null?void 0:n.leaderboard)==null?void 0:y.length)||0,"athletes"),console.log("Other categories selected:",p.map(a=>({name:a.name,count:a.userRankingCount}))),{goatFootballer:n,otherCategories:p}},enabled:!s&&!m&&!!r&&!!l,retry:1,staleTime:1e3*60*5})},Z=()=>{const{data:r,isLoading:s,isError:o}=Y();return e.jsxs(e.Fragment,{children:[e.jsx(P,{}),e.jsx("div",{className:"py-4 sm:py-6",children:e.jsxs("div",{className:"container mx-auto px-4 text-center flex flex-col items-center justify-center min-h-[120px]",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl lg:text-5xl font-bold text-white mb-4",children:"Your Voice, Your Vote, Your GOAT"}),e.jsx("p",{className:"text-lg sm:text-xl text-yellow-300 max-w-2xl mx-auto",children:"Your opinion shapes the ultimate football GOAT ranking"})]})}),e.jsx("div",{className:"flex flex-col flex-grow min-h-screen",style:{background:"linear-gradient(135deg, rgba(25, 7, 73, 0.6) 0%, rgba(7, 2, 21, 0.6) 100%)"},children:e.jsxs("div",{className:"container mx-auto px-4 py-8 flex-grow",children:[s&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[60%_40%] gap-8",children:[e.jsx("div",{children:e.jsx(C,{className:"h-[600px] w-full rounded-lg bg-white/5"})}),e.jsx("div",{children:e.jsx(C,{className:"h-[400px] w-full rounded-lg bg-white/5"})})]}),o&&e.jsxs("div",{className:"text-center text-red-400 text-lg space-y-2",children:[e.jsx("p",{children:"Could not load content. Please try again later."}),e.jsx("p",{className:"text-sm text-red-300",children:"Check the console for more details."})]}),!s&&!o&&r&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[60%_40%] gap-8 items-start",children:[e.jsx("div",{className:"w-full",children:e.jsx(W,{goatFootballer:r.goatFootballer})}),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg p-6 shadow-2xl",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-r from-fuchsia-600 to-cyan-600 mb-4",children:e.jsx(v,{className:"h-8 w-8 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Daily Quiz"}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Test your football knowledge and earn badges!"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-white font-medium",children:"Today's Challenge"}),e.jsx(L,{className:"h-5 w-5 text-yellow-400"})]}),e.jsx("p",{className:"text-gray-300 text-sm mb-4",children:"Answer questions about football legends and climb the leaderboard!"}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400 mb-4",children:[e.jsx("span",{children:"ðŸŽ¯ Earn points & badges"}),e.jsx("span",{children:"âš¡ Build your streak"})]})]}),e.jsx(A,{asChild:!0,className:"w-full bg-gradient-to-r from-fuchsia-600 to-cyan-600 hover:from-fuchsia-700 hover:to-cyan-700 text-white font-semibold py-3 text-lg",children:e.jsxs(w,{to:"/quiz",children:[e.jsx(v,{className:"h-5 w-5 mr-2"}),"Start Quiz"]})}),e.jsx("div",{className:"text-center",children:e.jsx(w,{to:"/quiz",className:"text-sm text-gray-400 hover:text-white transition-colors",children:"View Leaderboard â†’"})})]})]})})]})]})})]})};export{Z as default};
