import{c as A,j as e,b as R,B as j,R as _,E as O,P as S,H as C,L as D,C as L,S as N,d as T,a as k,s as v,e as $,f as G,u as H}from"./index-D6Dh-tOY.js";import{G as U,C as B}from"./CommentSection-qz_mWrea.js";import{S as M}from"./SocialActions-w3zlBMlD.js";import{u as q}from"./useUserRankingForCategory-BBEM16vD.js";import W from"./ComingSoonPage-BHkOC08E.js";import"./trending-down-CZzN4wpH.js";import"./trending-up-C7CvnSET.js";import"./ShareDialog-WkeXcJas.js";import"./textarea-DAWKKPAt.js";import"./flame-DVX3-eVT.js";import"./calendar-BKtBvoYG.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=A("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),z=({categoryId:r,leaderboardAthletes:n,submittedRankingsCount:a,categoryName:s,categoryDescription:d})=>{const t=e.jsx(M,{categoryId:r});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsx(U,{athletes:n,categoryName:s,customTitle:s,customSubtitle:d||`Greatest ${s.toLowerCase().replace("goat ","")} of all time`,submittedRankingsCount:a,socialActions:t})})}),e.jsx("div",{className:"mt-6 sm:mt-8",children:e.jsx(B,{categoryId:r})})]})},Q=({hasExistingRanking:r,userRankingId:n,categoryId:a,isLoadingUserRanking:s})=>{const d=R();console.log("🔍 FloatingActionButton - DETAILED PROPS:",{hasExistingRanking:r,userRankingId:n,categoryId:a,isLoadingUserRanking:s,currentUrl:window.location.href});const t=r?"View My Ranking":"Create Ranking",o=r?O:S,l=r?`/ranking/${n}`:`/create-ranking/${a}`,i=r?"View Your Ranking":"Create Your Ranking",g=x=>{x.preventDefault(),console.log("🔍 FloatingActionButton - BUTTON CLICKED!",{hasExistingRanking:r,userRankingId:n,categoryId:a,targetUrl:l}),r&&n?(console.log("🔍 FloatingActionButton - Navigating to existing ranking:",n),d(`/ranking/${n}`,{replace:!0})):(console.log("🔍 FloatingActionButton - Navigating to create ranking for category:",a),d(`/create-ranking/${a}`))};return s?(console.log("🔍 FloatingActionButton - SHOWING LOADING STATE"),e.jsx("div",{className:"fixed bottom-4 right-4 sm:bottom-6 sm:right-6 md:bottom-8 md:right-8 z-[9999]",children:e.jsx(j,{variant:"cta",className:"rounded-full shadow-2xl w-14 h-14 sm:w-16 sm:h-16 p-0 flex items-center justify-center md:w-auto md:px-6 md:py-3 md:h-12 opacity-75",disabled:!0,children:e.jsx("div",{className:"animate-spin h-6 w-6 border-2 border-white border-t-transparent rounded-full"})})})):(console.log("🔍 FloatingActionButton - RENDERING MAIN BUTTON"),e.jsx("div",{className:"fixed bottom-4 right-4 sm:bottom-6 sm:right-6 md:bottom-8 md:right-8 z-[9999]",children:e.jsxs(j,{variant:"cta",className:"rounded-full shadow-2xl hover:scale-105 transition-transform w-14 h-14 sm:w-16 sm:h-16 p-0 flex items-center justify-center md:w-auto md:px-6 md:py-3 md:h-12 bg-gradient-to-r from-fuchsia-500 to-cyan-500 text-white hover:opacity-90 border-0 font-semibold",onClick:g,title:i,children:[_.createElement(o,{className:"h-6 w-6 sm:h-7 sm:w-7 md:h-6 md:w-6 md:mr-2 shrink-0"}),e.jsx("span",{className:"hidden md:inline font-semibold",children:t})]})}))},E=()=>e.jsxs(e.Fragment,{children:[e.jsxs(C,{children:[e.jsx("title",{children:"Category Not Found | Wodagoat"}),e.jsx("meta",{name:"description",content:"The category you're looking for doesn't exist or couldn't be loaded. Please return to the homepage to explore other debates."})]}),e.jsx("div",{className:"flex flex-col flex-grow min-h-screen px-3 sm:px-4 md:px-8",style:{background:"linear-gradient(135deg, #190749 0%, #070215 100%)"},children:e.jsx("div",{className:"container mx-auto py-4 sm:py-6 md:py-8 text-center flex-grow flex items-center justify-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white mb-4",children:"Category Not Found"}),e.jsx("p",{className:"text-gray-300 mb-6 text-sm sm:text-base",children:"The category you're looking for doesn't exist or couldn't be loaded."}),e.jsx(j,{asChild:!0,variant:"outline",className:"border-white text-white hover:bg-white hover:text-indigo-900",children:e.jsxs(D,{to:"/",children:[e.jsx(L,{className:"mr-2 h-4 w-4"})," Go Back to Categories"]})})]})})})]}),Y=()=>e.jsxs(e.Fragment,{children:[e.jsxs(C,{children:[e.jsx("title",{children:"Loading Category... | Wodagoat"}),e.jsx("meta",{name:"description",content:"Loading category details, leaderboards, and community rankings."})]}),e.jsx("div",{className:"flex flex-col flex-grow min-h-screen px-3 sm:px-4 md:px-8",style:{background:"linear-gradient(135deg, #190749 0%, #070215 100%)"},children:e.jsxs("div",{className:"container mx-auto py-4 sm:py-6 md:py-8 flex-grow",children:[e.jsx(N,{className:"h-10 sm:h-12 w-32 sm:w-48 mb-6 sm:mb-8"}),e.jsx(N,{className:"h-8 sm:h-10 w-3/4 mb-2"}),e.jsx(N,{className:"h-4 sm:h-6 w-1/2 mb-6 sm:mb-8"}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 lg:gap-8",children:[e.jsx("div",{className:"w-full lg:w-2/3 xl:w-3/5",children:e.jsx(N,{className:"h-80 sm:h-96 w-full"})}),e.jsx("div",{className:"w-full lg:w-1/3 xl:w-2/5 space-y-4 sm:space-y-6",children:e.jsx(N,{className:"h-40 sm:h-48 w-full"})})]})]})})]}),J=({onRetry:r,isRetrying:n=!1})=>e.jsxs(e.Fragment,{children:[e.jsxs(C,{children:[e.jsx("title",{children:"Connection Error | Wodagoat"}),e.jsx("meta",{name:"description",content:"Unable to connect to the server. Please check your internet connection and try again."})]}),e.jsx("div",{className:"flex flex-col flex-grow min-h-screen px-3 sm:px-4 md:px-8",style:{background:"linear-gradient(135deg, #190749 0%, #070215 100%)"},children:e.jsx("div",{className:"container mx-auto py-4 sm:py-6 md:py-8 text-center flex-grow flex items-center justify-center",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsx(K,{className:"w-16 h-16 text-red-400 mx-auto mb-4"})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white mb-4",children:"Connection Error"}),e.jsx("p",{className:"text-gray-300 mb-2 text-sm sm:text-base",children:"Unable to load category data due to a network error."}),e.jsx("p",{className:"text-gray-400 mb-6 text-xs sm:text-sm",children:"Please check your internet connection and try again."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(j,{onClick:r,disabled:n,className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:n?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4 animate-spin"}),"Retrying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Try Again"]})}),e.jsx(j,{asChild:!0,variant:"outline",className:"w-full border-white text-white hover:bg-white hover:text-indigo-900",children:e.jsxs(D,{to:"/",children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Go Back to Categories"]})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-800/50 rounded-lg text-xs text-gray-400",children:[e.jsx("p",{children:e.jsx("strong",{children:"Troubleshooting:"})}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Check your internet connection"}),e.jsx("li",{children:"Try refreshing the page"}),e.jsx("li",{children:"If the problem persists, the server may be temporarily unavailable"})]})]})]})})})]}),V=r=>k({queryKey:["leaderboardData",r],queryFn:async()=>{var n;console.log(`🔍 ENHANCED: Fetching leaderboard data for category: ${r}`);try{const{data:a,error:s}=await v.rpc("get_category_leaderboard",{p_category_id:r,p_limit:10});if(s){if(console.error("🚨 ENHANCED: Error fetching leaderboard:",s),(n=s.message)!=null&&n.includes("function get_category_leaderboard does not exist"))return console.warn("⚠️ Database function missing, returning empty array"),[];throw new Error(`Leaderboard fetch failed: ${s.message}`)}if(console.log("✅ ENHANCED: Raw leaderboard data from database:",{categoryId:r,dataLength:(a==null?void 0:a.length)||0,data:a}),!a||a.length===0)return console.log(`📊 ENHANCED: No leaderboard data found for category ${r} - this is normal for categories with few rankings`),[];console.log(`🔄 ENHANCED: Processing leaderboard for category ${r}, found ${a.length} athletes`);const d=a.map((t,o)=>{try{console.log(`👤 ENHANCED: Processing athlete ${o+1}:`,t);const l={id:t.athlete_id||`athlete-${o}`,name:t.athlete_name||"Unknown Athlete",profile_picture_url:t.profile_picture_url||"/placeholder.svg",country_of_origin:t.country_of_origin||"",points:Number(t.total_points)||0,rank:Number(t.rank)||o+1,movement:t.movement||"neutral"};return console.log("✨ ENHANCED: Mapped athlete:",l),l}catch(l){return console.error("🚨 ENHANCED: Error mapping athlete data:",l,t),{id:`athlete-${o}`,name:"Unknown Athlete",profile_picture_url:"/placeholder.svg",country_of_origin:"",points:0,rank:o+1,movement:"neutral"}}});return console.log(`🎯 ENHANCED: Final leaderboard for category ${r}:`,{athleteCount:d.length,athletes:d}),d}catch(a){return console.error("🚨 ENHANCED: Fatal error in leaderboard fetch:",{categoryId:r,error:a instanceof Error?a.message:a,stack:a instanceof Error?a.stack:void 0}),[]}},enabled:!!r,staleTime:1e3*60*5,retry:(n,a)=>{var s;return console.log(`🔄 ENHANCED: Leaderboard fetch retry ${n} for category ${r}:`,a),(s=a==null?void 0:a.message)!=null&&s.includes("function get_category_leaderboard does not exist")?!1:n<2}}),X=({categoryId:r,children:n})=>{const a=$();console.log("🔧 CategoryPageDataFetcher - START:",{categoryId:r});const{data:s,isLoading:d,error:t}=q(r);console.log("🔧 CategoryPageDataFetcher - User ranking result:",{userRanking:s?{id:s.id}:null,categoryId:r,hasRanking:!!s,isLoadingUserRanking:d});const{data:o,isLoading:l,error:i,refetch:g}=k({queryKey:["category",r],queryFn:async()=>{console.log("🔧 CategoryPageDataFetcher - Fetching category data for ID:",r);try{const{data:m,error:c}=await v.from("categories").select("*").eq("id",r).single();if(c&&c.code!=="PGRST116")throw console.error("🔧 CategoryPageDataFetcher - Error fetching category:",c),c;return console.log("🔧 CategoryPageDataFetcher - Category data fetched:",m),m}catch(m){throw console.error("🔧 CategoryPageDataFetcher - Fatal category fetch error:",m),m}},enabled:!!r,retry:(m,c)=>{const y=(c==null?void 0:c.message)||"";return y.includes("Failed to fetch")||y.includes("NetworkError")?m<2:!1}}),{data:x,isLoading:b,error:h}=k({queryKey:["categoryRankingsCount",r],queryFn:async()=>{if(!r)return 0;try{console.log("🔧 CategoryPageDataFetcher - Fetching rankings count for category:",r);const{count:m,error:c}=await v.from("user_rankings").select("*",{count:"exact",head:!0}).eq("category_id",r);return c?(console.error("🔧 CategoryPageDataFetcher - Error fetching rankings count:",c),0):(console.log("🔧 CategoryPageDataFetcher - Rankings count result:",m),m||0)}catch(m){return console.error("🔧 CategoryPageDataFetcher - Fatal rankings count error:",m),0}},enabled:!!r,staleTime:1e3*60*2,retry:(m,c)=>{const y=(c==null?void 0:c.message)||"";return y.includes("Failed to fetch")||y.includes("NetworkError")?m<2:!1}}),{data:u,isLoading:p,error:f,refetch:w}=V(r||""),F=l||p||b||d;console.log("🔧 CategoryPageDataFetcher - FINAL STATE:",{isLoading:F,dbCategory:!!o,categoryName:o==null?void 0:o.name,userRanking:s?{id:s.id}:null,submittedRankingsCount:x,leaderboardAthletesCount:(u==null?void 0:u.length)||0,hasErrors:!!(i||f||t||h)});const P=()=>{console.log("🔧 CategoryPageDataFetcher - Retrying all queries..."),g(),w(),a.invalidateQueries({queryKey:["categoryRankingsCount",r]}),a.invalidateQueries({queryKey:["userRanking",r]})};return e.jsx(e.Fragment,{children:n({dbCategory:o,userRanking:s,submittedRankingsCount:x||0,leaderboardAthletes:u||[],isLoading:F,errors:{categoryError:i,leaderboardError:f,userRankingError:t,rankingsCountError:h},refetch:{refetchCategory:g,refetchLeaderboard:P}})})},ce=()=>{const{categoryId:r}=G(),{user:n}=H();if(console.log("🚀 CategoryPage - RENDER START:",{categoryId:r,userId:n==null?void 0:n.id,currentUrl:window.location.href}),!r)return console.error("❌ CategoryPage - No categoryId found in URL params"),e.jsx(E,{});const a=t=>{if(!t)return!1;const o=(t==null?void 0:t.message)||"";return["JWT expired","Unauthorized","Authentication failed","Invalid category","Category not found","Database connection failed"].some(i=>o.toLowerCase().includes(i.toLowerCase()))},s=t=>{if(!t)return!1;const o=(t==null?void 0:t.message)||"";return(o.includes("Failed to fetch")||o.includes("NetworkError")||(t==null?void 0:t.code)==="NETWORK_ERROR")&&!o.includes("ad blocker")&&!o.includes("extension")},d=(t,o)=>{const l=["premier league","laliga","la liga","serie a","bundesliga","ligue 1","champions league","world cup","euro","copa america","competition","tournament","league","championship"],i=(t||"").toLowerCase(),g="".toLowerCase();return l.some(x=>i.includes(x)||g.includes(x))||g.includes("competition")};return e.jsx(X,{categoryId:r,children:({dbCategory:t,userRanking:o,submittedRankingsCount:l,leaderboardAthletes:i,isLoading:g,errors:x,refetch:b})=>{const{categoryError:h,leaderboardError:u,userRankingError:p,rankingsCountError:f}=x;if(console.log("🚀 CategoryPage - DATA FETCHER RESULT:",{hasDbCategory:!!t,categoryName:t==null?void 0:t.name,hasUserRanking:!!o,userRankingId:o==null?void 0:o.id,submittedRankingsCount:l,leaderboardAthletesCount:(i==null?void 0:i.length)||0,isLoading:g,errorSummary:{categoryError:!!h,leaderboardError:!!u,userRankingError:!!p,rankingsCountError:!!f}}),g)return console.log("🚀 CategoryPage - SHOWING LOADING STATE"),e.jsx(Y,{});if(h&&a(h))return console.log("🚨 CRITICAL: Category error detected:",h),e.jsx(E,{});if(h&&s(h))return console.log("🌐 PERSISTENT NETWORK ERROR:",h),e.jsx(J,{onRetry:b.refetchLeaderboard});if((u||p||f)&&console.log("⚠️ NON-CRITICAL ERRORS (not blocking UI):",{leaderboardError:u==null?void 0:u.message,userRankingError:p==null?void 0:p.message,rankingsCountError:f==null?void 0:f.message}),!t)return console.log("🚀 CategoryPage - NO CATEGORY DATA"),e.jsx(E,{});if(d(t.name))return console.log("🚀 CategoryPage - SHOWING COMING SOON for competition category:",t.name),e.jsx(W,{categoryName:t.name});const w=!!(n&&o);return console.log("🚀 CategoryPage - RENDERING MAIN CONTENT:",{categoryName:t.name,hasExistingRanking:w,userRankingId:o==null?void 0:o.id,submittedRankingsCount:l,leaderboardCount:(i==null?void 0:i.length)||0}),e.jsxs(e.Fragment,{children:[e.jsxs(C,{children:[e.jsx("title",{children:`${t.name} - GOAT Debate | Wodagoat`}),e.jsx("meta",{name:"description",content:t.description||`Join the GOAT debate for ${t.name}. Create rankings, view leaderboards, and share your opinion with a global community of sports fans.`})]}),e.jsx("div",{className:"flex flex-col flex-grow min-h-screen px-3 sm:px-4 md:px-8",style:{background:"linear-gradient(135deg, #190749 0%, #070215 100%)"},children:e.jsxs("div",{className:"container mx-auto py-4 sm:py-6 md:py-8 flex-grow",children:[e.jsx(z,{categoryId:r,leaderboardAthletes:i,submittedRankingsCount:l,categoryName:t.name,categoryDescription:t.description}),e.jsx(Q,{hasExistingRanking:w,userRankingId:o==null?void 0:o.id,categoryId:r,isLoadingUserRanking:!1})]})})]})}})};export{ce as default};
