const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D6Dh-tOY.js","assets/index-CtDEE0DT.css"])))=>i.map(i=>d[i]);
import{c as P,a as h,s as f,ac as C,u as v,j as e,B as F,a6 as R,a3 as p,D as j,X as L,A as N,g as w,i as _,ad as S,ae as E,k as B,T,S as d,L as b,a9 as U,f as M,r as Q,l as K,m as $,ab as D,n as H,J as G}from"./index-D6Dh-tOY.js";import{Q as J}from"./QuizActivity-DMsz-v5y.js";import{u as Y,a as V}from"./useFriendActions-BRs1SMEo.js";import{f as X}from"./format-BHf82gLm.js";import{B as W}from"./BadgeShowcase-D8TwguRA.js";import"./BadgeCard-UnCSqldB.js";import"./tooltip-Bvq1edap.js";import"./target-Bezeda79.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=P("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),O=s=>h({queryKey:["publicUserBadges",s],queryFn:async()=>{if(!s)return[];try{const{data:t,error:r}=await f.from("user_badges").select("*").eq("user_id",s).order("earned_at",{ascending:!1});if(r)throw console.error("Error fetching user badges:",r),r;const{BADGES:i}=await C(async()=>{const{BADGES:n}=await import("./index-D6Dh-tOY.js").then(l=>l.bN);return{BADGES:n}},__vite__mapDeps([0,1]));return t.map(n=>{const l=i.find(x=>x.id===n.badge_id);return l?{id:n.id,badge_id:n.badge_id,user_id:n.user_id,earned_at:n.earned_at,badge:l}:(console.warn(`Badge definition not found for badge_id: ${n.badge_id}`),null)}).filter(n=>n!==null)}catch(t){return console.error("Error fetching user badges:",t),[]}},enabled:!!s}),I=({userId:s})=>{const{user:t}=v(),{data:r}=Y(t==null?void 0:t.id,s),{sendFriendRequest:i,cancelFriendRequest:a,acceptFriendRequest:n,removeFriend:l}=V();if(!t||t.id===s)return null;const o=(()=>{if(i.isPending||a.isPending)return{text:"Loading...",icon:R,variant:"secondary",disabled:!0};if(!r)return{text:"Add Friend",icon:p,variant:"default",disabled:!1,onClick:()=>i.mutate(s)};switch(r.status){case"pending":return r.requester_id===t.id?{text:"Cancel Request",icon:L,variant:"secondary",disabled:!1,onClick:()=>a.mutate(s)}:{text:"Accept Request",icon:j,variant:"default",disabled:!1,onClick:()=>n.mutate(r.id)};case"accepted":return{text:"Friends",icon:j,variant:"outline",disabled:!1,onClick:()=>l.mutate(r.id)};case"blocked":return{text:"Blocked",icon:Z,variant:"destructive",disabled:!0};default:return{text:"Add Friend",icon:p,variant:"default",disabled:!1,onClick:()=>i.mutate(s)}}})(),c=o.icon;return e.jsxs(F,{variant:o.variant,disabled:o.disabled,onClick:o.onClick,className:"w-full sm:w-auto bg-white text-gray-800 hover:bg-gray-100 border border-gray-300 font-medium",children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),o.text]})},ee=({profile:s,isOwnProfile:t})=>{var r;return e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs(N,{className:"h-20 w-20",children:[e.jsx(w,{src:s.avatar_url||void 0,alt:s.full_name||""}),e.jsx(_,{className:"text-2xl",children:((r=s.full_name)==null?void 0:r.charAt(0))||"U"})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("h2",{className:"text-2xl font-bold",children:s.full_name||"Anonymous User"}),s.country&&e.jsxs("div",{className:"flex items-center gap-1 text-gray-400",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{children:s.country})]}),s.favorite_sports&&s.favorite_sports.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4 text-red-400"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.favorite_sports.map(i=>e.jsx(B,{variant:"secondary",className:"text-xs",children:i},i))})]})]}),!t&&e.jsx("div",{className:"w-full sm:w-auto",children:e.jsx(I,{userId:s.id})})]})},se=s=>h({queryKey:["publicUserRankings",s],queryFn:async()=>{if(!s)return[];const{data:t,error:r}=await f.from("user_rankings").select(`
          id,
          title,
          created_at,
          category_id,
          categories ( name )
        `).eq("user_id",s).order("created_at",{ascending:!1}).limit(10);return r?(console.error("Error fetching public user rankings:",r),[]):t?t.map(i=>({...i,categories:Array.isArray(i.categories)?i.categories[0]||null:i.categories||null})):[]},enabled:!!s}),re=({userId:s,isOwnProfile:t})=>{const{data:r,isLoading:i}=se(s);return console.log("PublicRankingActivity - userRankings:",r),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),t?"My Recent Rankings":"Recent Rankings"]}),i?e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{className:"h-5 w-3/4 bg-white/10"}),e.jsx(d,{className:"h-5 w-1/2 bg-white/10"}),e.jsx(d,{className:"h-5 w-2/3 bg-white/10"})]}):r&&r.length>0?e.jsx("ul",{className:"space-y-3 text-gray-300",children:r.map(a=>{var n;return console.log("Rendering ranking:",a.id,a.title),e.jsxs("li",{className:"text-sm",children:[e.jsx(b,{to:`/ranking/${a.id}`,className:"font-semibold text-blue-400 hover:underline",onClick:()=>console.log("Clicked ranking link:",a.id),children:a.title}),e.jsxs("div",{className:"text-gray-400 text-xs",children:["in ",((n=a.categories)==null?void 0:n.name)||"a category"," â€¢ ",X(new Date(a.created_at),"MMM d, yyyy")]})]},a.id)})}):e.jsx("p",{className:"text-gray-400 text-sm",children:t?"No rankings submitted yet. Create your first one!":"This user hasn't created any rankings yet."})]})},ae=s=>h({queryKey:["publicFriends",s],queryFn:async()=>{if(!s)return[];const{data:t,error:r}=await f.from("friendships").select(`
          id,
          requester:requester_id(id, full_name, avatar_url),
          receiver:receiver_id(id, full_name, avatar_url)
        `).eq("status","accepted").or(`requester_id.eq.${s},receiver_id.eq.${s}`);return r?(console.error("Error fetching public friends:",r),[]):t?t.map(a=>{const n=Array.isArray(a.requester)?a.requester[0]:a.requester,l=Array.isArray(a.receiver)?a.receiver[0]:a.receiver;return!n||!l?null:n.id===s?l:n}).filter(a=>a!==null):[]},enabled:!!s}),te=({userId:s,isOwnProfile:t})=>{const{data:r,isLoading:i}=ae(s);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5"}),"Friends ",r&&r.length>0&&`(${r.length})`]}),i?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:[...Array(4)].map((a,n)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"h-8 w-8 rounded-full bg-white/10"}),e.jsx(d,{className:"h-4 w-16 bg-white/10"})]},n))}):r&&r.length>0?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:r.map(a=>{var n;return e.jsxs(b,{to:`/users/${a.id}`,className:"flex items-center gap-2 p-2 rounded-md hover:bg-white/10 transition-colors",children:[e.jsxs(N,{className:"h-8 w-8",children:[e.jsx(w,{src:a.avatar_url||void 0,alt:a.full_name||"User"}),e.jsx(_,{className:"text-xs",children:((n=a.full_name)==null?void 0:n.charAt(0).toUpperCase())||"U"})]}),e.jsx("span",{className:"text-sm font-medium truncate",children:a.full_name||"Anonymous"})]},a.id)})}):e.jsx("p",{className:"text-gray-400 text-sm",children:t?"You haven't added any friends yet.":"This user hasn't added any friends yet."})]})},ie=({userStats:s,isLoading:t})=>t?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[...Array(4)].map((r,i)=>e.jsx(d,{className:"h-20 bg-white/10 rounded-lg"},i))}):!s||s.totalQuizzes===0?null:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Quiz Performance"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white/5 p-4 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:s.totalQuizzes}),e.jsx("div",{className:"text-sm text-gray-400",children:"Quizzes Taken"})]}),e.jsxs("div",{className:"bg-white/5 p-4 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:s.totalScore}),e.jsx("div",{className:"text-sm text-gray-400",children:"Total Score"})]}),e.jsxs("div",{className:"bg-white/5 p-4 rounded-lg border border-gray-700",children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:[s.averageScore,"/5"]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Average Score"})]}),e.jsxs("div",{className:"bg-white/5 p-4 rounded-lg border border-gray-700",children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:[s.accuracy,"%"]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Accuracy"})]})]})]}),ne=({userBadges:s,isLoading:t,isOwnProfile:r})=>t?e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{className:"h-6 w-32 bg-white/10"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[...Array(4)].map((i,a)=>e.jsx(d,{className:"h-24 bg-white/10 rounded-lg"},a))})]}):s&&s.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Badges & Achievements"}),e.jsx(W,{userBadges:s})]}):e.jsxs("div",{className:"bg-white/5 p-6 rounded-lg border border-gray-700 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Badges Yet"}),e.jsx("p",{className:"text-gray-400",children:r?"Take quizzes to earn your first badge!":"This user hasn't earned any badges yet."})]}),ce=({profile:s,isLoading:t,isOwnProfile:r,userId:i,quizAttempts:a,isLoadingQuizAttempts:n,userStats:l,isLoadingStats:x})=>{const{data:o=[],isLoading:c}=O(i);return t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(d,{className:"h-20 w-20 rounded-full bg-white/10"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(d,{className:"h-6 w-48 mb-2 bg-white/10"}),e.jsx(d,{className:"h-4 w-32 bg-white/10"})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[...Array(4)].map((u,g)=>e.jsx(d,{className:"h-20 bg-white/10 rounded-lg"},g))})]}):s?e.jsxs("div",{className:"space-y-8",children:[e.jsx(ee,{profile:s,isOwnProfile:r}),e.jsx(ie,{userStats:l,isLoading:x}),e.jsx(ne,{userBadges:o,isLoading:c,isOwnProfile:r}),i&&e.jsx(re,{userId:i,isOwnProfile:r}),i&&e.jsx(te,{userId:i,isOwnProfile:r}),e.jsx(J,{quizAttempts:a,isLoading:n})]}):e.jsxs("div",{className:"text-center py-10",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Profile not found"}),e.jsx("p",{className:"text-lg text-gray-400 mb-4",children:"The user profile you are looking for does not exist."}),e.jsx(b,{to:"/feed",className:"text-blue-400 hover:text-blue-300 underline",children:"Return to Feed"})]})},fe=()=>{const{userId:s}=M(),{user:t}=v();Q.useEffect(()=>{window.scrollTo(0,0)},[s]);const{data:r,isLoading:i}=h({queryKey:["publicProfile",s],queryFn:async()=>{if(!s)return null;const{data:c,error:u}=await f.from("profiles").select("*").eq("id",s).single();return u?(u.code!=="PGRST116"&&(console.error("Error fetching public profile:",u),G.error("Failed to load profile.")),null):c},enabled:!!s}),{data:a,isLoading:n}=h({queryKey:["userQuizAttempts",s],queryFn:async()=>{if(!s)return[];const{data:c,error:u}=await f.from("quiz_attempts").select(`
          id,
          score,
          completed_at,
          quizzes (
            title,
            quiz_questions ( id )
          )
        `).eq("user_id",s).order("completed_at",{ascending:!1}).limit(10);return u?(console.error("Error fetching user quiz attempts:",u),[]):(c==null?void 0:c.map(m=>({...m,quizzes:Array.isArray(m.quizzes)?m.quizzes[0]:m.quizzes})))||[]},enabled:!!s}),{data:l,isLoading:x}=h({queryKey:["userStats",s],queryFn:async()=>{if(!s)return null;const{data:c,error:u}=await f.from("quiz_attempts").select("score, completed_at").eq("user_id",s).order("completed_at",{ascending:!1});if(u)return console.error("Error fetching user stats:",u),null;if(!c||c.length===0)return{totalQuizzes:0,totalScore:0,averageScore:0,perfectScores:0,accuracy:0};const g=c.length,m=c.reduce((y,k)=>y+k.score,0),q=c.filter(y=>y.score===5).length,A=m/g,z=m/(g*5)*100;return{totalQuizzes:g,totalScore:m,averageScore:Math.round(A*10)/10,perfectScores:q,accuracy:Math.round(z*10)/10}},enabled:!!s}),o=(t==null?void 0:t.id)===s;return e.jsx("div",{className:"container mx-auto px-4 py-12",children:e.jsxs(K,{className:"max-w-4xl mx-auto bg-white/5 text-white border-gray-700 shadow-lg",children:[e.jsx($,{children:e.jsx(D,{className:"text-2xl font-bold",children:o?"My Profile":"User Profile"})}),e.jsx(H,{children:e.jsx(ce,{profile:r,isLoading:i,isOwnProfile:o,userId:s,quizAttempts:a||[],isLoadingQuizAttempts:n,userStats:l,isLoadingStats:x})})]})})};export{fe as default};
