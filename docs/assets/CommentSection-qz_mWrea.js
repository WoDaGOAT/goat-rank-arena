import{c as $,j as e,A as y,g as N,h as g,i as C,k as M,r as L,l as Y,m as G,B as b,L as _,n as J,P as T,u as z,e as O,o as H,s as D,p as Q,J as S,X as K,q as U,M as F,t as q,v as P,a as W,S as X}from"./index-D6Dh-tOY.js";import{T as Z}from"./trending-down-CZzN4wpH.js";import{T as I}from"./trending-up-C7CvnSET.js";import{S as ee}from"./ShareDialog-WkeXcJas.js";import{T as V}from"./textarea-DAWKKPAt.js";import{a as se}from"./useUserRankingForCategory-BBEM16vD.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=$("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=$("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=$("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=$("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),ie=({athlete:s,position:a,compact:i=!1})=>{const u=()=>{switch(s.movement){case"up":return e.jsx(I,{className:"h-4 w-4 text-green-400"});case"down":return e.jsx(Z,{className:"h-4 w-4 text-red-400"});default:return e.jsx(re,{className:"h-4 w-4 text-gray-400"})}},n=()=>a===1?"text-yellow-400 font-bold text-xl":a===2?"text-gray-300 font-bold text-lg":a===3?"text-orange-400 font-bold text-lg":"text-gray-400 font-semibold",c=()=>a===1?"ðŸ¥‡":a===2?"ðŸ¥ˆ":a===3?"ðŸ¥‰":null,o=i?"px-3 py-2 sm:px-4 sm:py-3":"px-4 py-3 sm:px-6 sm:py-4";return e.jsxs("div",{className:`${o} hover:bg-white/5 transition-colors duration-200`,children:[e.jsxs("div",{className:"md:hidden flex items-center gap-3",children:[e.jsx("div",{className:`w-8 text-center ${n()}`,children:c()||a}),e.jsxs(y,{className:`border-2 border-white/20 ${i?"h-10 w-10":"h-12 w-12"}`,children:[e.jsx(N,{src:s.imageUrl,alt:g(s.name)}),e.jsx(C,{children:g(s.name).charAt(0)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold text-white truncate ${i?"text-sm":"text-base"}`,children:g(s.name)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{variant:"secondary",className:`${i?"text-xs px-2 py-0.5":"text-sm"}`,children:s.points.toLocaleString()}),u()]})]})]}),e.jsxs("div",{className:"hidden md:grid md:grid-cols-[50px_72px_1fr_110px_90px] gap-4 items-center",children:[e.jsx("div",{className:`text-center ${n()}`,children:c()||a}),e.jsxs(y,{className:`border-2 border-white/20 ${i?"h-10 w-10":"h-12 w-12"}`,children:[e.jsx(N,{src:s.imageUrl,alt:g(s.name)}),e.jsx(C,{children:g(s.name).charAt(0)})]}),e.jsx("div",{children:e.jsx("h3",{className:`font-semibold text-white truncate ${i?"text-sm":"text-base"}`,children:g(s.name)})}),e.jsx("div",{className:"flex justify-center",children:u()}),e.jsx("div",{className:"text-center",children:e.jsx(M,{variant:"secondary",className:i?"text-xs px-2 py-0.5":"text-sm",children:s.points.toLocaleString()})})]})]})},pe=({athletes:s,categoryName:a,submittedRankingsCount:i=0,socialActions:u,compact:n=!1,categoryId:c,customTitle:o,customSubtitle:j})=>{const[t,d]=L.useState(!1),m=window.location.href,r=`Check out the ${g(a)} leaderboard on WoDaGOAT!`,h=n?s.slice(0,5):s.slice(0,10),x=s&&Array.isArray(s)&&s.length>0,f=i<3,l=o||g(a),p=j||"";return console.log("ðŸ”§ GlobalLeaderboard - Render decision:",{shouldShowInsufficientMessage:f,submittedRankingsCount:i,athletesLength:(s==null?void 0:s.length)||0,hasValidAthletes:x,categoryName:a,categoryId:c,displayAthletes:(h==null?void 0:h.length)||0}),e.jsxs(Y,{className:"shadow-2xl bg-white/10 backdrop-blur-sm border border-white/20 w-full",children:[e.jsxs(G,{className:`border-b border-white/30 bg-white/5 relative overflow-hidden ${n?"p-3 sm:p-4":"p-3 sm:p-4 md:p-6"}`,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/5 via-transparent to-white/5"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:`font-bold text-white mb-1 ${n?"text-lg sm:text-xl":"text-lg sm:text-xl md:text-2xl"}`,children:l}),p&&e.jsx("h2",{className:`font-medium text-gray-300 mb-2 ${n?"text-sm":"text-sm sm:text-base"}`,children:p}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-300 font-medium",children:["âœ… ",i.toLocaleString()," Submitted Rankings"]})]}),e.jsxs("div",{className:"absolute right-0 top-0 flex gap-2",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>d(!0),className:"border-white/20 bg-white/10 text-white hover:bg-white/20 text-xs sm:text-sm px-3 py-1.5 sm:px-4 sm:py-2",children:[e.jsx(ne,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),"Share"]}),n&&c&&e.jsx(b,{asChild:!0,variant:"outline",size:"sm",className:"border-white/20 bg-white/10 text-white hover:bg-white/20 text-xs sm:text-sm px-3 py-1.5 sm:px-4 sm:py-2",children:e.jsxs(_,{to:`/category/${c}`,children:[e.jsx(te,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),"View Full"]})})]})]})]}),e.jsxs(J,{className:"p-0",children:[f?e.jsx("div",{className:"flex flex-col items-center justify-center py-12 px-4 sm:px-6 text-center min-h-[300px] bg-gradient-to-b from-white/5 to-white/10",children:e.jsxs("div",{className:"w-full max-w-md mx-auto",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 rounded-full bg-gradient-to-r from-blue-500/30 to-purple-500/30 border-2 border-white/20 flex items-center justify-center shadow-lg",children:e.jsx(T,{className:"h-10 w-10 text-white"})}),e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-white mb-4 drop-shadow-sm",children:"Not Enough Rankings Yet"}),e.jsxs("p",{className:"text-sm sm:text-base text-gray-200 mb-6 leading-relaxed drop-shadow-sm",children:["We need at least 3 rankings to show a meaningful leaderboard. Be one of the first to rank the greatest ",g(a.toLowerCase().replace("goat ","")),"!"]}),e.jsxs("div",{className:"text-xs text-gray-300 mb-6 bg-white/10 rounded-full px-4 py-2 inline-block",children:["Current rankings: ",e.jsx("span",{className:"font-bold",children:i})," / ",e.jsx("span",{className:"font-bold",children:"3"})," needed"]}),c&&e.jsx(b,{asChild:!0,variant:"default",size:"lg",className:"bg-blue-600 hover:bg-blue-700 text-white border-0 rounded-full px-8 py-3 font-semibold shadow-lg hover:shadow-xl transition-all",children:e.jsxs(_,{to:`/create-ranking/${c}`,children:[e.jsx(T,{className:"h-5 w-5 mr-2"}),"Create Your Ranking"]})})]})}):x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`hidden md:grid md:grid-cols-[50px_72px_1fr_110px_90px] gap-4 items-center px-4 bg-white/5 border-b border-white/20 text-xs font-bold text-gray-300 uppercase tracking-wide ${n?"py-2":"py-3"}`,children:[e.jsx("div",{className:"text-center",children:"#"}),e.jsx("div",{}),e.jsx("div",{children:"Player"}),e.jsx("div",{className:"text-center",children:"Trend"}),e.jsx("div",{className:"text-center",children:"Score"})]}),e.jsx("div",{className:"divide-y divide-white/20",children:h.map((w,v)=>e.jsx(ie,{athlete:w,position:v+1,compact:n},w.id))})]}):e.jsx("div",{className:"flex flex-col items-center justify-center py-12 px-4 sm:px-6 text-center min-h-[200px]",children:e.jsxs("div",{className:"text-white",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Leaderboard Loading"}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Rankings are being processed..."})]})}),u&&!f&&e.jsx("div",{className:`border-t border-white/20 bg-white/5 ${n?"p-3":"p-3 sm:p-4"}`,children:u})]}),e.jsx(ee,{open:t,onOpenChange:d,url:m,text:r})]})},B=({categoryId:s,parentCommentId:a,onCancel:i,onSuccess:u})=>{var h,x,f;const[n,c]=L.useState(""),{user:o,openLoginDialog:j}=z(),t=O(),{mutate:d,isPending:m}=H({mutationFn:async l=>{if(!o)throw j(),new Error("User not authenticated");const{data:p,error:w}=await D.functions.invoke("post-comment",{body:{categoryId:s,commentText:l,parentCommentId:a}});if(w){if(w instanceof Q)try{const v=await w.context.json();throw new Error(v.error||"Failed to post reply.")}catch{throw new Error("Failed to post reply - server error.")}throw w}if(!p)throw new Error("Reply could not be created - no response.");return p},onSuccess:()=>{c(""),t.invalidateQueries({queryKey:["categoryComments",s]}),S.success("Reply posted!"),u==null||u()},onError:l=>{l.message!=="User not authenticated"&&S.error(l.message||"Failed to post reply. Please try again.")}}),r=l=>{l.preventDefault(),n.trim()?d(g(n.trim())):S.error("Please enter a reply before posting.")};return e.jsx("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(y,{className:"w-8 h-8 flex-shrink-0",children:[e.jsx(N,{src:(h=o==null?void 0:o.user_metadata)==null?void 0:h.avatar_url,alt:((x=o==null?void 0:o.user_metadata)==null?void 0:x.full_name)||"You"}),e.jsx(C,{className:"text-xs bg-white/20 text-white",children:(((f=o==null?void 0:o.user_metadata)==null?void 0:f.full_name)||"You").charAt(0).toUpperCase()})]}),e.jsx("div",{className:"flex-1",children:e.jsxs("form",{onSubmit:r,className:"space-y-3",children:[e.jsx(V,{value:n,onChange:l=>c(l.target.value),placeholder:"Add a reply...",className:"bg-white/10 border-white/20 text-white placeholder:text-gray-400 text-sm resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent min-h-[80px]",disabled:m}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(b,{type:"button",variant:"ghost",size:"sm",onClick:i,className:"text-gray-400 hover:text-white hover:bg-white/10",disabled:m,children:[e.jsx(K,{className:"w-4 h-4 mr-1"}),"Cancel"]}),e.jsxs(b,{type:"submit",disabled:m||!n.trim(),size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white font-medium",children:[e.jsx(ae,{className:"w-4 h-4 mr-1"}),m?"Posting...":"Reply"]})]})]})})]})})},E=({comment:s,replies:a=[],categoryId:i,isReply:u=!1,allComments:n=[]})=>{var v,R,A;const{user:c,openLoginDialog:o}=z(),[j,t]=L.useState(!1),[d,m]=L.useState(!0),r=g((v=s.profiles)==null?void 0:v.full_name)||"Anonymous",h=(R=s.profiles)==null?void 0:R.avatar_url,x=(A=s.profiles)==null?void 0:A.id,f=u?n.filter(k=>k.parent_comment_id===s.id):a,l=f.length,p=()=>{if(!c){o();return}t(!0)},w=()=>{m(!0),t(!1)};return u?e.jsxs("div",{className:"flex gap-3",children:[x?e.jsx(_,{to:`/users/${x}`,children:e.jsxs(y,{className:"w-6 h-6 flex-shrink-0 cursor-pointer hover:opacity-80 transition-opacity",children:[e.jsx(N,{src:h||void 0,alt:r}),e.jsx(C,{className:"text-xs bg-white/20 text-white",children:r.charAt(0).toUpperCase()})]})}):e.jsxs(y,{className:"w-6 h-6 flex-shrink-0",children:[e.jsx(N,{src:h||void 0,alt:r}),e.jsx(C,{className:"text-xs bg-white/20 text-white",children:r.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[x?e.jsx(_,{to:`/users/${x}`,className:"text-xs font-medium text-white hover:text-blue-300 hover:underline transition-colors",children:r}):e.jsx("span",{className:"text-xs font-medium text-white",children:r}),e.jsx("span",{className:"text-xs text-gray-400",children:U(new Date(s.created_at),{addSuffix:!0})})]}),e.jsx("div",{className:"text-sm text-gray-200 mb-2 whitespace-pre-wrap break-words leading-relaxed",children:g(s.comment)}),e.jsxs(b,{variant:"ghost",size:"sm",onClick:p,className:"text-gray-400 hover:text-white h-6 px-2 text-xs font-medium hover:bg-white/10",children:[e.jsx(F,{className:"w-3 h-3 mr-1"}),"Reply"]}),j&&e.jsx("div",{className:"mt-3",children:e.jsx(B,{categoryId:i,parentCommentId:s.id,onCancel:()=>t(!1),onSuccess:w})}),l>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>m(!d),className:"text-blue-400 hover:text-blue-300 h-6 px-0 text-xs font-medium hover:bg-transparent mb-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-3 h-3 mr-1"}),"Hide ",l," ",l===1?"reply":"replies"]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"View ",l," ",l===1?"reply":"replies"]})}),d&&e.jsx("div",{className:"ml-4 border-l border-white/10 pl-3 space-y-3",children:f.map(k=>e.jsx(E,{comment:k,replies:[],categoryId:i,isReply:!0,allComments:n},k.id))})]})]})]}):e.jsx("div",{className:"pb-4",children:e.jsxs("div",{className:"flex gap-3",children:[x?e.jsx(_,{to:`/users/${x}`,children:e.jsxs(y,{className:"w-10 h-10 flex-shrink-0 cursor-pointer hover:opacity-80 transition-opacity",children:[e.jsx(N,{src:h||void 0,alt:r}),e.jsx(C,{className:"text-sm bg-white/20 text-white",children:r.charAt(0).toUpperCase()})]})}):e.jsxs(y,{className:"w-10 h-10 flex-shrink-0",children:[e.jsx(N,{src:h||void 0,alt:r}),e.jsx(C,{className:"text-sm bg-white/20 text-white",children:r.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[x?e.jsx(_,{to:`/users/${x}`,className:"text-sm font-semibold text-white hover:text-blue-300 hover:underline transition-colors",children:r}):e.jsx("span",{className:"text-sm font-semibold text-white",children:r}),e.jsx("span",{className:"text-xs text-gray-400",children:U(new Date(s.created_at),{addSuffix:!0})})]}),e.jsx("div",{className:"text-sm text-gray-200 mb-3 whitespace-pre-wrap break-words leading-relaxed",children:g(s.comment)}),e.jsx("div",{className:"flex items-center gap-4 mb-3",children:e.jsxs(b,{variant:"ghost",size:"sm",onClick:p,className:"text-gray-400 hover:text-white h-8 px-3 text-xs font-medium hover:bg-white/10",children:[e.jsx(F,{className:"w-3 h-3 mr-1.5"}),"Reply"]})}),j&&e.jsx("div",{className:"mb-4",children:e.jsx(B,{categoryId:i,parentCommentId:s.id,onCancel:()=>t(!1),onSuccess:w})}),l>0&&e.jsxs("div",{children:[e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>m(!d),className:"text-blue-400 hover:text-blue-300 h-8 px-0 text-sm font-medium hover:bg-transparent mb-3",children:d?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4 mr-1"}),"Hide ",l," ",l===1?"reply":"replies"]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 mr-1"}),"View ",l," ",l===1?"reply":"replies"]})}),d&&e.jsx("div",{className:"ml-8 border-l-2 border-white/10 pl-4 space-y-4",children:a.map(k=>e.jsx(E,{comment:k,replies:[],categoryId:i,isReply:!0,allComments:n},k.id))})]})]})]})})},le=({categoryId:s,parentCommentId:a,onSuccess:i,placeholder:u="Share your thoughts..."})=>{var h,x,f,l;const[n,c]=L.useState(""),[o,j]=L.useState(!1),{user:t}=z(),{trackCommentPosted:d}=se(),m=H({mutationFn:async({comment:p,categoryId:w,parentCommentId:v})=>{if(!t)throw new Error("You must be logged in to post a comment.");const{data:R,error:A}=await D.from("comments").insert({comment:p,category_id:w,user_id:t.id,parent_comment_id:v}).select().single();if(A)throw new Error(A.message);return d(w),R},onSuccess:p=>{S.success("Comment posted!"),c(""),i&&i()},onError:p=>{S.error("Failed to post comment.",{description:p.message})}}),r=async p=>{if(p.preventDefault(),!o){if(!n.trim()){S.error("Comment cannot be empty.");return}j(!0);try{await m.mutateAsync({comment:n,categoryId:s,parentCommentId:a})}finally{j(!1)}}};return e.jsxs("form",{onSubmit:r,className:"flex items-start gap-4",children:[e.jsxs(y,{className:"h-10 w-10",children:[e.jsx(N,{src:((h=t==null?void 0:t.user_metadata)==null?void 0:h.avatar_url)||void 0,alt:((x=t==null?void 0:t.user_metadata)==null?void 0:x.full_name)||"User"}),e.jsx(C,{children:((l=(f=t==null?void 0:t.user_metadata)==null?void 0:f.full_name)==null?void 0:l.charAt(0))||"U"})]}),e.jsxs("div",{className:"w-full space-y-2",children:[e.jsx(V,{placeholder:u,value:n,onChange:p=>c(p.target.value),rows:2,className:"resize-none"}),e.jsx(b,{type:"submit",disabled:o,size:"sm",children:"Post Comment"})]})]})},ue=({categoryId:s})=>{const{data:a,isLoading:i,error:u}=W({queryKey:["categoryComments",s],queryFn:async()=>{const{data:t,error:d}=await D.from("category_comments").select("*, profiles (id, full_name, avatar_url)").eq("category_id",s).order("created_at",{ascending:!1});if(d)throw d;return t},enabled:!!s}),n=t=>{const d=[],m={};return t==null||t.forEach(r=>{r.parent_comment_id?(m[r.parent_comment_id]||(m[r.parent_comment_id]=[]),m[r.parent_comment_id].push(r)):d.push(r)}),Object.keys(m).forEach(r=>{m[r].sort((h,x)=>new Date(h.created_at).getTime()-new Date(x.created_at).getTime())}),{topLevelComments:d,repliesMap:m}},{topLevelComments:c,repliesMap:o}=n(a||[]),j=(a==null?void 0:a.length)||0;return e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"p-4 sm:p-6 bg-white/10 backdrop-blur-sm rounded-lg shadow-lg border border-white/20 mt-6 sm:mt-8",children:[e.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center",children:[e.jsx(F,{className:"w-5 h-5 mr-2 text-blue-300"}),j," ",j===1?"Comment":"Comments"]}),e.jsx(le,{categoryId:s}),e.jsxs("div",{className:"mt-6 space-y-4",children:[i&&Array.from({length:3}).map((t,d)=>e.jsx(X,{className:"h-20 w-full bg-white/10"},d)),u&&e.jsx("p",{className:"text-red-400",children:"Could not load comments."}),c.length===0&&!i&&e.jsx("p",{className:"text-gray-400 text-center py-8",children:"Be the first to comment!"}),c.map(t=>e.jsx(E,{comment:t,replies:o[t.id]||[],categoryId:s,allComments:a||[]},t.id))]})]})})};export{ue as C,pe as G};
