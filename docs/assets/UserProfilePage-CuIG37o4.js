import{c as I,h as C,j as e,A as U,g as L,i as D,a7 as M,u as j,r as u,s as x,J as g,w as N,I as A,a8 as P,S as p,L as F,M as R,q as B,B as $,X as K,e as Q,a as _,o as z,a9 as T,aa as J,l as H,m as G,ab as O,n as X}from"./index-D6Dh-tOY.js";import{f as S}from"./format-BHf82gLm.js";import{u as Y}from"./useUserQuizAttempts-DN2PSnCZ.js";import{Q as V}from"./QuizActivity-DMsz-v5y.js";import"./BadgeCard-UnCSqldB.js";import"./tooltip-Bvq1edap.js";import"./target-Bezeda79.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=I("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Z=({profile:a,user:t,name:s,isUploading:i,handleAvatarUpload:r})=>{var o;const l=C(s);return e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs(U,{className:"h-20 w-20",children:[e.jsx(L,{src:(a==null?void 0:a.avatar_url)||void 0,alt:l}),e.jsx(D,{children:(l==null?void 0:l.charAt(0))||((o=t.email)==null?void 0:o.charAt(0))})]}),e.jsx("label",{htmlFor:"avatar-upload",className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-full cursor-pointer opacity-0 group-hover:opacity-100 transition-opacity",children:i?e.jsx(M,{className:"h-8 w-8 text-white animate-spin aspect-square"}):e.jsx(W,{className:"h-8 w-8 text-white aspect-square"})}),e.jsx("input",{type:"file",id:"avatar-upload",className:"hidden",accept:"image/png, image/jpeg, image/gif",onChange:r,disabled:i})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:l||t.email}),e.jsx("p",{className:"text-gray-400",children:t.email||""})]})]})},ee=()=>{const{user:a,refetchUser:t}=j(),[s,i]=u.useState(!1);return{isSaving:s,handleSaveChanges:async({name:l,country:o,favoriteSports:c})=>{if(!a)return;i(!0);const{error:n}=await x.from("profiles").update({full_name:C(l),country:o,favorite_sports:c}).eq("id",a.id);i(!1),n?g.error(n.message):(g.success("Profile updated successfully!"),await t())}}},ae=({name:a,setName:t,country:s,setCountry:i,user:r,favoriteSports:l,handleSportChange:o,availableSports:c})=>{const{handleSaveChanges:n}=ee(),h=u.useCallback(d=>{t(d)},[t]),m=u.useCallback(d=>{d.key==="Enter"&&n({name:a,country:s,favoriteSports:l})},[a,s,l,n]),y=u.useCallback(()=>{n({name:a,country:s,favoriteSports:l})},[a,s,l,n]),f=u.useCallback(d=>{i(d)},[i]),w=u.useCallback(d=>{d.key==="Enter"&&n({name:a,country:s,favoriteSports:l})},[a,s,l,n]),b=u.useCallback(()=>{n({name:a,country:s,favoriteSports:l})},[a,s,l,n]),v=u.useCallback(d=>{const k=l.includes(d)?l.filter(q=>q!==d):[...l,d];o(d),n({name:a,country:s,favoriteSports:k})},[l,a,s,o,n]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold border-b border-gray-600 pb-2",children:"Basic Info"}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"name-profile",children:"Display Name"}),e.jsx(A,{id:"name-profile",value:a,onChange:d=>h(d.target.value),onKeyDown:m,onBlur:y,className:"bg-white/10 border-gray-600 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"email-profile",children:"Email"}),e.jsx(A,{id:"email-profile",type:"email",value:r.email||"",readOnly:!0,className:"bg-white/10 border-gray-600 cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"country-profile",children:"Country"}),e.jsx(A,{id:"country-profile",value:s,onChange:d=>f(d.target.value),onKeyDown:w,onBlur:b,className:"bg-white/10 border-gray-600 focus:border-blue-500",placeholder:"e.g. United States"})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Favorite Sport(s)"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 pt-2",children:c.map(d=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{id:`sport-${d}`,checked:l.includes(d),onCheckedChange:()=>v(d),className:"border-gray-500 data-[state=checked]:bg-blue-500 data-[state=checked]:border-blue-500"}),e.jsx(N,{htmlFor:`sport-${d}`,className:"font-normal cursor-pointer",children:d})]},d))})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Date Joined"}),e.jsx("p",{className:"text-gray-300 pt-2",children:r.created_at?S(new Date(r.created_at),"MMMM d, yyyy"):"N/A"})]})]})},se=({likedCategories:a,isLoading:t,userRankings:s,isLoadingUserRankings:i})=>e.jsxs("div",{className:"space-y-6 pt-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold border-b border-gray-600 pb-2 mb-3",children:"My Recent Rankings"}),i?e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"h-5 w-3/4 bg-gray-700"}),e.jsx(p,{className:"h-5 w-1/2 bg-gray-700"}),e.jsx(p,{className:"h-5 w-2/3 bg-gray-700"})]}):s&&s.length>0?e.jsx("ul",{className:"space-y-3 text-gray-300",children:s.map(r=>{var l;return e.jsxs("li",{className:"text-sm",children:[e.jsx(F,{to:`/ranking/${r.id}`,className:"font-semibold text-blue-400 hover:underline",children:r.title}),e.jsxs("div",{className:"text-gray-400 text-xs",children:["in ",((l=r.categories)==null?void 0:l.name)||"a category"," â€¢ ",S(new Date(r.created_at),"MMM d, yyyy")]})]},r.id)})}):e.jsx("p",{className:"text-gray-400 text-sm",children:"No rankings submitted yet. Create your first one!"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold border-b border-gray-600 pb-2 mb-3",children:"Liked Leaderboards"}),t?e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"h-5 w-1/2 bg-gray-700"}),e.jsx(p,{className:"h-5 w-1/3 bg-gray-700"})]}):a&&a.length>0?e.jsx("ul",{className:"list-disc list-inside space-y-1 text-gray-300",children:a.map(r=>r&&e.jsx("li",{children:e.jsx(F,{to:`/category/${r.id}`,className:"text-blue-400 hover:underline",children:r.name})},r.id))}):e.jsx("p",{className:"text-gray-400",children:"No liked leaderboards yet. Go like some!"})]})]}),re=({userComments:a,isLoading:t})=>t?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Comments"}),e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((s,i)=>e.jsx(p,{className:"h-16 bg-white/10"},i))})]}):!a||a.length===0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Comments"}),e.jsxs("div",{className:"bg-white/5 p-4 rounded-lg border border-gray-700 text-center",children:[e.jsx(R,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-400",children:"No comments yet. Start engaging with the community!"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Comments"}),e.jsx("div",{className:"space-y-3",children:a.map(s=>{var i;return e.jsxs("div",{className:"bg-white/5 p-4 rounded-lg border border-gray-700",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx(F,{to:`/category/${s.category_id}`,className:"text-blue-300 hover:text-blue-200 font-medium text-sm hover:underline",children:(i=s.categories)!=null&&i.name?C(s.categories.name):"Unknown Category"}),e.jsx("span",{className:"text-xs text-gray-400",children:B(new Date(s.created_at),{addSuffix:!0})})]}),e.jsx("p",{className:"text-gray-200 text-sm line-clamp-2",children:C(s.comment)})]},s.id)})})]}),te=({friend:a,onRemove:t,isRemoving:s,friendshipId:i})=>{var r;return e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-md hover:bg-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(U,{children:[e.jsx(L,{src:a.avatar_url||void 0,alt:a.full_name||"User"}),e.jsx(D,{children:((r=a.full_name)==null?void 0:r.charAt(0).toUpperCase())||"U"})]}),e.jsx("span",{className:"font-medium",children:a.full_name||"Anonymous User"})]}),e.jsx($,{variant:"ghost",size:"icon",onClick:()=>t(i),disabled:s,className:"text-gray-400 hover:text-red-500 hover:bg-red-500/10","aria-label":"Remove friend",children:e.jsx(K,{className:"w-4 h-4"})})]})},ie=()=>{const{user:a}=j(),t=Q(),{data:s,isLoading:i}=_({queryKey:["friends",a==null?void 0:a.id],queryFn:async()=>{if(!a)return[];const{data:c,error:n}=await x.from("friendships").select(`
          id,
          requester:requester_id(id, full_name, avatar_url),
          receiver:receiver_id(id, full_name, avatar_url)
        `).eq("status","accepted").or(`requester_id.eq.${a.id},receiver_id.eq.${a.id}`);return n?(g.error("Failed to fetch friends."),console.error("Error fetching friends:",n),[]):c?c.map(m=>{const y=Array.isArray(m.requester)?m.requester[0]:m.requester,f=Array.isArray(m.receiver)?m.receiver[0]:m.receiver;return!y||!f?null:{id:m.id,requester:y,receiver:f}}).filter(m=>m!==null):[]},enabled:!!a}),{mutate:r,isPending:l}=z({mutationFn:async c=>{const{error:n}=await x.from("friendships").delete().eq("id",c);if(n)throw new Error("Could not remove friend.")},onSuccess:()=>{g.success("Friend removed."),t.invalidateQueries({queryKey:["friends",a==null?void 0:a.id]})},onError:c=>{g.error(c.message)}}),o=(s==null?void 0:s.map(c=>{const n=c.requester.id===(a==null?void 0:a.id)?c.receiver:c.requester;return{friendshipId:c.id,...n}}))||[];return e.jsxs("div",{className:"pt-4",children:[e.jsxs("h3",{className:"text-xl font-semibold pb-4 flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"Friends"]}),e.jsx("div",{children:i?e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"h-12 w-full bg-gray-700/50 rounded-md"}),e.jsx(p,{className:"h-12 w-full bg-gray-700/50 rounded-md"})]}):o.length>0?e.jsx("div",{className:"space-y-1",children:o.map(c=>e.jsx(te,{friend:c,onRemove:r,isRemoving:l,friendshipId:c.friendshipId},c.id))}):e.jsx("p",{className:"text-gray-400 text-sm",children:"You haven't added any friends yet."})})]})},le=()=>{const{user:a,loading:t}=j();return _({queryKey:["likedCategories",a==null?void 0:a.id],queryFn:async()=>{if(!a)return[];const{data:s,error:i}=await x.from("category_likes").select("categories (id, name)").eq("user_id",a.id);return i?(g.error("Failed to fetch liked leaderboards."),console.error("Error fetching liked categories:",i),[]):s?s.map(r=>r.categories).flat().filter(Boolean):[]},enabled:!!a&&!t})},ne=()=>{const{user:a}=j();return _({queryKey:["userComments",a==null?void 0:a.id],queryFn:async()=>{if(!a)return[];const{data:t,error:s}=await x.from("category_comments").select(`
                    id,
                    comment,
                    created_at,
                    category_id,
                    categories ( name )
                `).eq("user_id",a.id).order("created_at",{ascending:!1}).limit(5);return s?(g.error("Failed to fetch your comments."),console.error("Error fetching user comments:",s),[]):t?t.map(r=>({...r,categories:Array.isArray(r.categories)?r.categories[0]||null:r.categories||null})):[]},enabled:!!a})},ce=()=>{const{user:a}=j();return _({queryKey:["userRankings",a==null?void 0:a.id],queryFn:async()=>{if(!a)return[];const{data:t,error:s}=await x.from("user_rankings").select(`
                    id,
                    title,
                    created_at,
                    category_id,
                    categories ( name )
                `).eq("user_id",a.id).order("created_at",{ascending:!1}).limit(10);return s?(g.error("Failed to fetch your rankings."),console.error("Error fetching user rankings:",s),[]):t?t.map(r=>({...r,categories:Array.isArray(r.categories)?r.categories[0]||null:r.categories||null})):[]},enabled:!!a})},de=a=>{const[t,s]=u.useState(""),[i,r]=u.useState(""),[l,o]=u.useState([]);return u.useEffect(()=>{a&&(s(a.full_name||""),r(a.country||""),o(a.favorite_sports||[]))},[a]),{name:t,setName:s,country:i,setCountry:r,favoriteSports:l,handleSportChange:n=>{o(h=>h.includes(n)?h.filter(m=>m!==n):[...h,n])}}},oe=()=>{const{user:a,profile:t,refetchUser:s}=j(),[i,r]=u.useState(!1);return{isUploading:i,handleAvatarUpload:async o=>{var n;if(!a)return;const c=(n=o.target.files)==null?void 0:n[0];if(c){r(!0);try{if(t!=null&&t.avatar_url){const v=t.avatar_url.split("/").pop();v&&await x.storage.from("avatars").remove([v])}const h=c.name.split(".").pop(),y=`${`${a.id}-${Date.now()}.${h}`}`,{error:f}=await x.storage.from("avatars").upload(y,c);if(f)throw f;const{data:{publicUrl:w}}=x.storage.from("avatars").getPublicUrl(y),{error:b}=await x.from("profiles").update({avatar_url:w}).eq("id",a.id);if(b)throw b;g.success("Avatar updated successfully!"),await s()}catch(h){g.error(h.message||"Failed to upload avatar.")}finally{r(!1),o.target&&(o.target.value="")}}}}},pe=()=>{const{user:a,profile:t,loading:s}=j(),{name:i,setName:r,country:l,setCountry:o,favoriteSports:c,handleSportChange:n}=de(t),{isUploading:h,handleAvatarUpload:m}=oe(),{data:y,isLoading:f}=le(),{data:w,isLoading:b}=ne(),{data:v,isLoading:d}=ce(),{data:k,isLoading:q}=Y(),E=["American Football","Baseball","Basketball","Boxe","Cricket","F1","MMA","Soccer","Tennis"].sort();return s?e.jsx("div",{className:"flex flex-grow items-center justify-center",style:{background:"linear-gradient(135deg, #190749 0%, #070215 100%)"},children:e.jsx("div",{className:"text-white text-xl",children:"Loading profile..."})}):a?e.jsx("div",{className:"flex flex-col flex-grow",style:{background:"linear-gradient(135deg, #190749 0%, #070215 100%)"},children:e.jsx("div",{className:"container mx-auto px-4 py-12 flex-grow",children:e.jsxs(H,{className:"max-w-2xl mx-auto bg-white/5 text-white border-gray-700 shadow-lg",children:[e.jsx(G,{children:e.jsx(O,{className:"text-2xl font-bold",children:"User Profile"})}),e.jsxs(X,{className:"space-y-6",children:[e.jsx(Z,{profile:t,user:a,name:i,isUploading:h,handleAvatarUpload:m}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(ae,{name:i,setName:r,country:l,setCountry:o,user:a,favoriteSports:c,handleSportChange:n,availableSports:E}),e.jsx(se,{likedCategories:y,isLoading:f,userRankings:v,isLoadingUserRankings:d}),e.jsx(V,{quizAttempts:k,isLoading:q}),e.jsx(re,{userComments:w,isLoading:b}),e.jsx("div",{className:"border-t border-gray-700"}),e.jsx(ie,{})]})]})]})})}):e.jsx(J,{to:"/",replace:!0})};export{pe as default};
